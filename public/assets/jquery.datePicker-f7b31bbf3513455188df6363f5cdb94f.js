/**
 * Copyright (c) 2008 Kelvin Luck (http://www.kelvinluck.com/)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) 
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 * .
 * $Id: jquery.datePicker.js 103 2010-09-22 08:54:28Z kelvin.luck $
 **/
(function(a){function c(a){this.ele=a,this.displayedMonth=null,this.displayedYear=null,this.startDate=null,this.endDate=null,this.showYearNavigation=null,this.closeOnSelect=null,this.displayClose=null,this.rememberViewedMonth=null,this.selectMultiple=null,this.numSelectable=null,this.numSelected=null,this.verticalPosition=null,this.horizontalPosition=null,this.verticalOffset=null,this.horizontalOffset=null,this.button=null,this.renderCallback=[],this.selectedDates={},this.inline=null,this.context="#dp-popup",this.settings={}}function d(b){return b._dpId?a.event._dpCache[b._dpId]:!1}a.fn.extend({renderCalendar:function(b){var c=function(a){return document.createElement(a)};b=a.extend({},a.fn.datePicker.defaults,b);if(b.showHeader!=a.dpConst.SHOW_HEADER_NONE){var d=a(c("tr"));for(var e=Date.firstDayOfWeek;e<Date.firstDayOfWeek+7;e++){var f=e%7,g=Date.dayNames[f];d.append(jQuery(c("th")).attr({scope:"col",abbr:g,title:g,"class":f==0||f==6?"weekend":"weekday"}).html(b.showHeader==a.dpConst.SHOW_HEADER_SHORT?g.substr(0,1):g))}}var h=a(c("table")).attr({cellspacing:2}).addClass("jCalendar").append(b.showHeader!=a.dpConst.SHOW_HEADER_NONE?a(c("thead")).append(d):c("thead")),i=a(c("tbody")),j=(new Date).zeroTime();j.setHours(12);var k=b.month==undefined?j.getMonth():b.month,l=b.year||j.getFullYear(),m=new Date(l,k,1,12,0,0),n=Date.firstDayOfWeek-m.getDay()+1;n>1&&(n-=7);var o=Math.ceil((-1*n+1+m.getDaysInMonth())/7);m.addDays(n-1);var p=function(c){return function(){if(b.hoverClass){var d=a(this);b.selectWeek?c&&!d.is(".disabled")&&d.parent().addClass("activeWeekHover"):d.addClass(b.hoverClass)}}},q=function(){if(b.hoverClass){var c=a(this);c.removeClass(b.hoverClass),c.parent().removeClass("activeWeekHover")}},r=0;while(r++<o){var s=jQuery(c("tr")),t=b.dpController?m>b.dpController.startDate:!1;for(var e=0;e<7;e++){var u=m.getMonth()==k,v=a(c("td")).text(m.getDate()+"").addClass((u?"current-month ":"other-month ")+(m.isWeekend()?"weekend ":"weekday ")+(u&&m.getTime()==j.getTime()?"today ":"")).data("datePickerDate",m.asString()).hover(p(t),q);s.append(v),b.renderCallback&&b.renderCallback(v,m,k,l),m=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1,12,0,0)}i.append(s)}return h.append(i),this.each(function(){a(this).empty().append(h)})},datePicker:function(b){return a.event._dpCache||(a.event._dpCache=[]),b=a.extend({},a.fn.datePicker.defaults,b),this.each(function(){var d=a(this),e=!0;this._dpId||(this._dpId=a.event.guid++,a.event._dpCache[this._dpId]=new c(this),e=!1),b.inline&&(b.createButton=!1,b.displayClose=!1,b.closeOnSelect=!1,d.empty());var f=a.event._dpCache[this._dpId];f.init(b),!e&&b.createButton&&(f.button=a('<a href="#" class="dp-choose-date" title="'+a.dpText.TEXT_CHOOSE_DATE+'">'+a.dpText.TEXT_CHOOSE_DATE+"</a>").bind("click",function(){return d.dpDisplay(this),this.blur(),!1}),d.after(f.button));if(!e&&d.is(":text")){d.bind("dateSelected",function(a,b,c){this.value=b.asString()}).bind("change",function(){if(this.value=="")f.clearSelected();else{var a=Date.fromString(this.value);a&&f.setSelected(a,!0,!0)}}),b.clickInput&&d.bind("click",function(){d.trigger("change"),d.dpDisplay()});var g=Date.fromString(this.value);this.value!=""&&g&&f.setSelected(g,!0,!0)}d.addClass("dp-applied")})},dpSetDisabled:function(a){return b.call(this,"setDisabled",a)},dpSetStartDate:function(a){return b.call(this,"setStartDate",a)},dpSetEndDate:function(a){return b.call(this,"setEndDate",a)},dpGetSelected:function(){var a=d(this[0]);return a?a.getSelected():null},dpSetSelected:function(a,c,d,e){return c==undefined&&(c=!0),d==undefined&&(d=!0),e==undefined&&(e=!0),b.call(this,"setSelected",Date.fromString(a),c,d,e)},dpSetDisplayedMonth:function(a,c){return b.call(this,"setDisplayedMonth",Number(a),Number(c),!0)},dpDisplay:function(a){return b.call(this,"display",a)},dpSetRenderCallback:function(a){return b.call(this,"setRenderCallback",a)},dpSetPosition:function(a,c){return b.call(this,"setPosition",a,c)},dpSetOffset:function(a,c){return b.call(this,"setOffset",a,c)},dpClose:function(){return b.call(this,"_closeCalendar",!1,this[0])},dpRerenderCalendar:function(){return b.call(this,"_rerenderCalendar")},_dpDestroy:function(){}});var b=function(a,b,c,e,f){return this.each(function(){var g=d(this);g&&g[a](b,c,e,f)})};a.extend(c.prototype,{init:function(a){this.setStartDate(a.startDate),this.setEndDate(a.endDate),this.setDisplayedMonth(Number(a.month),Number(a.year)),this.setRenderCallback(a.renderCallback),this.showYearNavigation=a.showYearNavigation,this.closeOnSelect=a.closeOnSelect,this.displayClose=a.displayClose,this.rememberViewedMonth=a.rememberViewedMonth,this.selectMultiple=a.selectMultiple,this.numSelectable=a.selectMultiple?a.numSelectable:1,this.numSelected=0,this.verticalPosition=a.verticalPosition,this.horizontalPosition=a.horizontalPosition,this.hoverClass=a.hoverClass,this.setOffset(a.verticalOffset,a.horizontalOffset),this.inline=a.inline,this.settings=a,this.inline&&(this.context=this.ele,this.display())},setStartDate:function(a){a&&(a instanceof Date?this.startDate=a:this.startDate=Date.fromString(a)),this.startDate||(this.startDate=(new Date).zeroTime()),this.setDisplayedMonth(this.displayedMonth,this.displayedYear)},setEndDate:function(a){a&&(a instanceof Date?this.endDate=a:this.endDate=Date.fromString(a)),this.endDate||(this.endDate=new Date("12/31/2999")),this.endDate.getTime()<this.startDate.getTime()&&(this.endDate=this.startDate),this.setDisplayedMonth(this.displayedMonth,this.displayedYear)},setPosition:function(a,b){this.verticalPosition=a,this.horizontalPosition=b},setOffset:function(a,b){this.verticalOffset=parseInt(a)||0,this.horizontalOffset=parseInt(b)||0},setDisabled:function(b){$e=a(this.ele),$e[b?"addClass":"removeClass"]("dp-disabled"),this.button&&($but=a(this.button),$but[b?"addClass":"removeClass"]("dp-disabled"),$but.attr("title",b?"":a.dpText.TEXT_CHOOSE_DATE)),$e.is(":text")&&$e.attr("disabled",b?"disabled":"")},setDisplayedMonth:function(b,c,d){if(this.startDate==undefined||this.endDate==undefined)return;var e=new Date(this.startDate.getTime());e.setDate(1);var f=new Date(this.endDate.getTime());f.setDate(1);var g;!b&&!c||isNaN(b)&&isNaN(c)?(g=(new Date).zeroTime(),g.setDate(1)):isNaN(b)?g=new Date(c,this.displayedMonth,1):isNaN(c)?g=new Date(this.displayedYear,b,1):g=new Date(c,b,1),g.getTime()<e.getTime()?g=e:g.getTime()>f.getTime()&&(g=f);var h=this.displayedMonth,i=this.displayedYear;this.displayedMonth=g.getMonth(),this.displayedYear=g.getFullYear(),d&&(this.displayedMonth!=h||this.displayedYear!=i)&&(this._rerenderCalendar(),a(this.ele).trigger("dpMonthChanged",[this.displayedMonth,this.displayedYear]))},setSelected:function(b,c,d,e){if(b<this.startDate||b.zeroTime()>this.endDate.zeroTime())return;var f=this.settings;if(f.selectWeek){b=b.addDays(-(b.getDay()-Date.firstDayOfWeek+7)%7);if(b<this.startDate)return}if(c==this.isSelected(b))return;if(this.selectMultiple==0)this.clearSelected();else if(c&&this.numSelected==this.numSelectable)return;d&&(this.displayedMonth!=b.getMonth()||this.displayedYear!=b.getFullYear())&&this.setDisplayedMonth(b.getMonth(),b.getFullYear(),!0),this.selectedDates[b.asString()]=c,this.numSelected+=c?1:-1;var g="td."+(b.getMonth()==this.displayedMonth?"current-month":"other-month"),h;a(g,this.context).each(function(){a(this).data("datePickerDate")==b.asString()&&(h=a(this),f.selectWeek&&h.parent()[c?"addClass":"removeClass"]("selectedWeek"),h[c?"addClass":"removeClass"]("selected"))}),a("td",this.context).not(".selected")[this.selectMultiple&&this.numSelected==this.numSelectable?"addClass":"removeClass"]("unselectable");if(e){var f=this.isSelected(b);$e=a(this.ele);var i=Date.fromString(b.asString());$e.trigger("dateSelected",[i,h,f]),$e.trigger("change")}},isSelected:function(a){return this.selectedDates[a.asString()]},getSelected:function(){var a=[];for(var b in this.selectedDates)this.selectedDates[b]==1&&a.push(Date.fromString(b));return a},clearSelected:function(){this.selectedDates={},this.numSelected=0,a("td.selected",this.context).removeClass("selected").parent().removeClass("selectedWeek")},display:function(b){if(a(this.ele).is(".dp-disabled"))return;b=b||this.ele;var c=this,d=a(b),e=d.offset(),f,g,h,i;if(c.inline)f=a(this.ele),g={id:"calendar-"+this.ele._dpId,"class":"dp-popup dp-popup-inline"},a(".dp-popup",f).remove(),i={};else{f=a("body"),g={id:"dp-popup","class":"dp-popup"},i={top:e.top+c.verticalOffset,left:e.left+c.horizontalOffset};var j=function(b){var d=b.target,e=a("#dp-popup")[0];for(;;){if(d==e)return!0;if(d==document)return c._closeCalendar(),!1;d=a(d).parent()[0]}};this._checkMouse=j,c._closeCalendar(!0),a(document).bind("keydown.datepicker",function(a){a.keyCode==27&&c._closeCalendar()})}if(!c.rememberViewedMonth){var k=this.getSelected()[0];k&&(k=new Date(k),this.setDisplayedMonth(k.getMonth(),k.getFullYear(),!1))}f.append(a("<div></div>").attr(g).css(i).append(a("<h2></h2>"),a('<div class="dp-nav-prev"></div>').append(a('<a class="dp-nav-prev-year" href="#" title="'+a.dpText.TEXT_PREV_YEAR+'">&lt;&lt;</a>').bind("click",function(){return c._displayNewMonth.call(c,this,0,-1)}),a('<a class="dp-nav-prev-month" href="#" title="'+a.dpText.TEXT_PREV_MONTH+'">&lt;</a>').bind("click",function(){return c._displayNewMonth.call(c,this,-1,0)})),a('<div class="dp-nav-next"></div>').append(a('<a class="dp-nav-next-year" href="#" title="'+a.dpText.TEXT_NEXT_YEAR+'">&gt;&gt;</a>').bind("click",function(){return c._displayNewMonth.call(c,this,0,1)}),a('<a class="dp-nav-next-month" href="#" title="'+a.dpText.TEXT_NEXT_MONTH+'">&gt;</a>').bind("click",function(){return c._displayNewMonth.call(c,this,1,0)})),a('<div class="dp-calendar"></div>')).bgIframe());var l=this.inline?a(".dp-popup",this.context):a("#dp-popup");this.showYearNavigation==0&&a(".dp-nav-prev-year, .dp-nav-next-year",c.context).css("display","none"),this.displayClose&&l.append(a('<a href="#" id="dp-close">'+a.dpText.TEXT_CLOSE+"</a>").bind("click",function(){return c._closeCalendar(),!1})),c._renderCalendar(),a(this.ele).trigger("dpDisplayed",l),c.inline||(this.verticalPosition==a.dpConst.POS_BOTTOM&&l.css("top",e.top+d.height()-l.height()+c.verticalOffset),this.horizontalPosition==a.dpConst.POS_RIGHT&&l.css("left",e.left+d.width()-l.width()+c.horizontalOffset),a(document).bind("mousedown.datepicker",this._checkMouse))},setRenderCallback:function(a){if(a==null)return;a&&typeof a=="function"&&(a=[a]),this.renderCallback=this.renderCallback.concat(a)},cellRender:function(b,c,d,e){var f=this.dpController,g=new Date(c.getTime());b.bind("click",function(){var b=a(this);if(!b.is(".disabled")){f.setSelected(g,!b.is(".selected")||!f.selectMultiple,!1,!0);if(f.closeOnSelect){if(f.settings.autoFocusNextInput){var c=f.ele,d=!1;a(":input",c.form).each(function(){if(d)return a(this).focus(),!1;this==c&&(d=!0)})}else f.ele.focus();f._closeCalendar()}}}),f.isSelected(g)?(b.addClass("selected"),f.settings.selectWeek&&b.parent().addClass("selectedWeek")):f.selectMultiple&&f.numSelected==f.numSelectable&&b.addClass("unselectable")},_applyRenderCallbacks:function(){var b=this;a("td",this.context).each(function(){for(var c=0;c<b.renderCallback.length;c++)$td=a(this),b.renderCallback[c].apply(this,[$td,Date.fromString($td.data("datePickerDate")),b.displayedMonth,b.displayedYear])});return},_displayNewMonth:function(b,c,d){return a(b).is(".disabled")||this.setDisplayedMonth(this.displayedMonth+c,this.displayedYear+d,!0),b.blur(),!1},_rerenderCalendar:function(){this._clearCalendar(),this._renderCalendar()},_renderCalendar:function(){a("h2",this.context).html((new Date(this.displayedYear,this.displayedMonth,1)).asString(a.dpText.HEADER_FORMAT)),a(".dp-calendar",this.context).renderCalendar(a.extend({},this.settings,{month:this.displayedMonth,year:this.displayedYear,renderCallback:this.cellRender,dpController:this,hoverClass:this.hoverClass}));if(this.displayedYear==this.startDate.getFullYear()&&this.displayedMonth==this.startDate.getMonth()){a(".dp-nav-prev-year",this.context).addClass("disabled"),a(".dp-nav-prev-month",this.context).addClass("disabled"),a(".dp-calendar td.other-month",this.context).each(function(){var b=a(this);Number(b.text())>20&&b.addClass("disabled")});var b=this.startDate.getDate();a(".dp-calendar td.current-month",this.context).each(function(){var c=a(this);Number(c.text())<b&&c.addClass("disabled")})}else{a(".dp-nav-prev-year",this.context).removeClass("disabled"),a(".dp-nav-prev-month",this.context).removeClass("disabled");var b=this.startDate.getDate();if(b>20){var c=this.startDate.getTime(),d=new Date(c);d.addMonths(1),this.displayedYear==d.getFullYear()&&this.displayedMonth==d.getMonth()&&a(".dp-calendar td.other-month",this.context).each(function(){var b=a(this);Date.fromString(b.data("datePickerDate")).getTime()<c&&b.addClass("disabled")})}}if(this.displayedYear==this.endDate.getFullYear()&&this.displayedMonth==this.endDate.getMonth()){a(".dp-nav-next-year",this.context).addClass("disabled"),a(".dp-nav-next-month",this.context).addClass("disabled"),a(".dp-calendar td.other-month",this.context).each(function(){var b=a(this);Number(b.text())<14&&b.addClass("disabled")});var b=this.endDate.getDate();a(".dp-calendar td.current-month",this.context).each(function(){var c=a(this);Number(c.text())>b&&c.addClass("disabled")})}else{a(".dp-nav-next-year",this.context).removeClass("disabled"),a(".dp-nav-next-month",this.context).removeClass("disabled");var b=this.endDate.getDate();if(b<13){var e=new Date(this.endDate.getTime());e.addMonths(-1),this.displayedYear==e.getFullYear()&&this.displayedMonth==e.getMonth()&&a(".dp-calendar td.other-month",this.context).each(function(){var c=a(this),d=Number(c.text());d<13&&d>b&&c.addClass("disabled")})}}this._applyRenderCallbacks()},_closeCalendar:function(b,c){if(!c||c==this.ele)a(document).unbind("mousedown.datepicker"),a(document).unbind("keydown.datepicker"),this._clearCalendar(),a("#dp-popup a").unbind(),a("#dp-popup").empty().remove(),b||a(this.ele).trigger("dpClosed",[this.getSelected()])},_clearCalendar:function(){a(".dp-calendar td",this.context).unbind(),a(".dp-calendar",this.context).empty()}}),a.dpConst={SHOW_HEADER_NONE:0,SHOW_HEADER_SHORT:1,SHOW_HEADER_LONG:2,POS_TOP:0,POS_BOTTOM:1,POS_LEFT:0,POS_RIGHT:1,DP_INTERNAL_FOCUS:"dpInternalFocusTrigger"},a.dpText={TEXT_PREV_YEAR:"Previous year",TEXT_PREV_MONTH:"Previous month",TEXT_NEXT_YEAR:"Next year",TEXT_NEXT_MONTH:"Next month",TEXT_CLOSE:"Close",TEXT_CHOOSE_DATE:"Choose date",HEADER_FORMAT:"mmmm yyyy"},a.dpVersion="$Id: jquery.datePicker.js 103 2010-09-22 08:54:28Z kelvin.luck $",a.fn.datePicker.defaults={month:undefined,year:undefined,showHeader:a.dpConst.SHOW_HEADER_SHORT,startDate:undefined,endDate:undefined,inline:!1,renderCallback:null,createButton:!0,showYearNavigation:!0,closeOnSelect:!0,displayClose:!1,selectMultiple:!1,numSelectable:Number.MAX_VALUE,clickInput:!1,rememberViewedMonth:!0,selectWeek:!1,verticalPosition:a.dpConst.POS_TOP,horizontalPosition:a.dpConst.POS_LEFT,verticalOffset:0,horizontalOffset:0,hoverClass:"dp-hover",autoFocusNextInput:!1},a.fn.bgIframe==undefined&&(a.fn.bgIframe=function(){return this}),a(window).bind("unload",function(){var b=a.event._dpCache||[];for(var c in b)a(b[c].ele)._dpDestroy()})})(jQuery)