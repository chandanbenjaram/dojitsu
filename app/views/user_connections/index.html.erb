<%= stylesheet_link_tag('challenges.css','simple-tabs','jquery-ui', 'ui.core','ui.progressbar', 'main')%>
<%= javascript_include_tag('jquery.facebook.multifriend.select','simple-tabs','ui.progressbar','on_the_spot')%>
<%= render 'layouts/loggedinbody'%>
<% as= current_user.challenges.size %>


<div bgcolor="#f4f4f4" ,class="topbar" style="margin-top: 0px; width: 100%; height: 30px; background: none repeat scroll 0% 0% rgb(244, 244, 244); top: -20px; position: relative;">
	
				<div class="invitee_button" ><%= render :partial => 'invitations' %></div>
			
			<div class="profile_name">
				<b  id="image" > </b>
			</div>
		
</div>



<div id="ch_main_div5">
	<p class="user"><font color="orange"><%=current_user.facebook.name%></font></p>
	<table border="1px">
		<tr width="600px">
			<td width="100px" height="200px" id="image1" align="left">
			</td>
			<td width="570px" height="200px">
				<table border =5 bordercolor=#f4f4f4>
					<tr>
						<td width="100px">
							<!--<font color="#999999"><b>TROPHIES</b></font>--></td>
						</td>
						<td align="left">
							<!--<font color="gray">No of trophies</font>-->
						</td>
					</tr>
				</table>
				<table>
					<tr>
						<td width="100px">
							<font color="#999999"><b>MEMBER SINCE</b></font></td>
						</td>
						<td align="left">
							<%  user = User.find(:all)%>
							<%= current_user.created_at%>
						</td>
					</tr>
				</table>
				<hr/>
				<table border =5 bordercolor=#f4f4f4>
					<tr>
						<td width="100px">
							<font color="#999999"><b>ACHIEVEMENTS</b></font>
						</td>
						<td align="left">
							<% sum=0 %>
							<% current_user.challenges.each  do |ch| %>
								<% t= 0 %>
								<% ch.tasks.each do |tasks| %>
								<% t = t+1 %>
								<% end %>
								<% sum = sum + t %>
							 <% end %>
							<font color="gray"><b><%= current_user.challenges.length %>&nbsp;Challenges&nbsp;and&nbsp;<%= sum%>&nbsp;tasks</b></font>
						</td>
					</tr>
				</table>
				
				<hr/>
				
				<table height="10px">
					<tr height="10px">
						<td width="100px" height="10px">
							<font color="#999999"><b> CURRENT CITY</b></font></td>
						</td>
						<td align="left" height="10px">
							<p id="location"></p>
						</td>
					</tr>
				</table>
					<hr/>
				<table>
					<tr>
						<td width="100px">
							<font color="#999999"><b>HOME CITY</b></font></td>
						</td>
						<td align="left">
							<p id="hometown"></p>
						</td>
					</tr>
				</table>
				<hr/>
				<table>
					<tr>
						<td width="100px">
							<font color="#999999"><b> SEX</b></font></td>
						</td>
						<td align="left"  id="image2">
							<%=  %>
						</td>
					</tr>
				</table>
				<hr/>
				<table>
					<tr>
						<td width="100px">
							<font color="#999999"><b>BIRTH DAY</b></font></td>
						</td>
						<td align="left" id="image3">
							<%#= current_user.facebook.birthday %>
						</td>
					</tr>
				</table>
				<hr/>
				<table>
					<tr>
						<td width="100px">
							<font color="#999999"><b>ABOUT ME</b></font></td>
						</td>
						<td align="left">
							<%  about_me = current_user.facebook.bio %>
							<%= about_me %>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	 </table>
	<table width="100%" border="0" style="margin-top:0px;">
		<tr>
			<td colspan="3">
    			<ul class="tabs">
    				<li><a href="#tab1"><b>MY DOJO</b></a></li>
    				<li><a href="#tab2"><b>CHALLENGES</b></a></li>
				</ul>
	<div class="tab_container1">
    	<div id="tab1" class="tab_content2">
		<table bgcolor=#F4F4F4 height="30px">
							<tr bgcolor=#F4F4F4>
								<% allConnections = UserConnection.find(:all, :conditions =>["user_id=?", current_user.id]) %>
								<% group =Array.new %>
								<% allConnections.each  do |eachConnection| %>
									<% group.push(eachConnection.target_id) %>
								<% end %>
									<script>
										function contactToInvitee() 
										{
										 var contact = '<%= group.join(",") %>';
										 window.fbAsyncInit();
											FB.ui({
											  method: 'send',
											  to:contact,
											  name: 'Do your best',
											  link: 'http://www.dojitsu.com'
													 });										 
										 }
									</script>			
								 <td width="440px" height="40px">
									<font color="#8c8c8c"><b><style="float: right;">Total:</style>	<%= group.length %><%= image_tag("btn_msg_up.png", :onclick=>"contactToInvitee()") %></font><b >
								</td>
							<td width = "80px" id="search"  height="40px">
									</td>
								<td width="30px"  height="40px">
									<p class="invite"><%= link_to ( image_tag ("search_it.PNG") , :class=>"image_tag") %><p>
								</td>
								<td  height="40px" width="50px">
									<p class="invite"><%#= render :partial => 'invitations' %>
									<%= image_tag("invite.PNG", :width=> "100px" , :height => "30px" )%>
  
									<%= hidden_field_tag "myvar", 0%>	
									</p>
								</td>
							</tr>
						</table>
    		<table width="100%" border="0">
  				<tr>
    				<td>
					
						<table  border="0"> 
							<tr bgcolor=#d7d7d7>
								<td>NAME
								</td>
								<td  width="100px">
									STATUS
								</td>
							</tr>
						</table>
						
						<table bgcolor="white">
							<tr>
								<td>
									<div id="wrap">
										<h1 id="header"></h1>
							<table bgcolor="white">
										<% allConnections = UserConnection.find(:all, :conditions =>["user_id=?", current_user.id]) %>
												
											<tr>
											<td id="list">				
													
												                      <% allConnections.each  do |eachConnection| %>
											
													<p><a href="#"  id="ahref"><%=image_tag(FbGraph::User.new(eachConnection.target_id).fetch.picture) %>
													<b><%= FbGraph::User.new(eachConnection.target_id).fetch.name %> </b>
													<span id="status_icon"> 
														<%= image_tag('btn_msg_up.png', :id => "#{eachConnection.target_id}", :class =>"private_msg" )%>
													<%= link_to image_tag("btn_delete_up.png" , :class =>"private_msg1"), user_connection_path(eachConnection.id), :confirm => 'Are you sure?', :method => :delete %>
													 
												</span> </a>
													</p>
														<% end %>
												</td>
										</tr>	
								
									</table>
										<script>
													$(document).ready(function() {
														$(".private_msg").click(function(event) {
															var targetId = event.target.id;								
															$.dojitsu.renderSendBox("Testing", <%= "'+targetId+'"%>, <%= "'http://www.dojitsu.com" + "'"%>, <%= "'"+ challenges_url() +"'"%>);
														});
													});
												</script>				
									</div> 
								</td>
							</tr>
						</table> 
						
						
						
					</td>
                </tr>
            </table>				
		</div>
				

<script>
	(function ($) {
	  jQuery.expr[':'].Contains = function(a,i,m){
		  return (a.textContent || a.innerText || "").toUpperCase().indexOf(m[3].toUpperCase())>=0;
	  };

	  function listFilter(header, list) {
		var form = $("<form>").attr({"class":"filterform","action":"#"}),
			input = $("<input>").attr({"class":"filterinput","type":"text"});
		$("#search").append($(form).append(input).appendTo(header));

		$(input)
		  .change( function () {
			var filter = $(this).val();
			if(filter) {
			  $(list).find("a:not(:Contains(" + filter + "))").parent().slideUp();
			  $(list).find("a:Contains(" + filter + ")").parent().slideDown();
			} else {
			  $(list).find("tr").slideDown();
			}
			return false;
		  })
		.keyup( function () {
			$(this).change();
		});
	  }
	  $(function () {
		listFilter($("#header"), $("#list"));
	  });
	}(jQuery));
</script> 			
		<div id="tab2" class="tab_content2"><br>
          <%= render :partial=> "dashboard/dashboardsidebar" %>						
		</div>
		</div>
</td>
</tr>
</table>
 <script>
window.fbAsyncInit();
FB.getLoginStatus(function(response) {
             if (response.session)
{
                   globaluserid=response.session["uid"];
name=globaluserid;
FB.api(
                     {
                        method: 'fql.query',
                         query: 'SELECT uid1 FROM friend WHERE uid2='+globaluserid
                      },
                    function(response)
                      {
FB.api({
method: 'fql.query',
query: 'SELECT name,pic_big,sex,birthday FROM user WHERE uid=' + name
}, function(response){
htmlcontent = '<img src=' + response[0].pic_big+ ' />';
htmlcontent1=response[0].name
htmlcontent2=response[0].sex
htmlcontent3=response[0].birthday
$("#image").append(htmlcontent1);
$("#image1").append(htmlcontent);
$("#image2").append(htmlcontent2);
$("#image3").append(htmlcontent3);
});
}
                        );
						
FB.api('/me', function(response) {
var location = response.location.name;
var hometown = response.hometown.name;
$("#hometown").append(hometown);
$("#location").append(location);
});
FB.api(
{
method: 'permissions.request',
perms: 'user_birthday',
},
function(response) {
console.log(response);
FB.api('/me', function(response){
console.log(response);
display: 'none'
var bir =response[0].birthday;
var email=response[0].email;
});
}
);
            }
    });
 </script> 