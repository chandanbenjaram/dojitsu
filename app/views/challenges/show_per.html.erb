<%= stylesheet_link_tag('simple-tabs','datePicker', 'colorbox','jquery-ui', 'ui.progressbar','ui.theme', 'main','soc-per','challenges.css')%>
<%= javascript_include_tag('simple-tabs','ui.progressbar','jquery.colorbox-min', 'jquery.cluetip.js','jquery.table.addrow','jquery.datePicker','date','on_the_spot','jquery.tools.min','soc-per','challenge_new','fbWallPost')%>
<%= render 'layouts/loggedinbody'%>
<div class="challengeSubNav">

   	<%= button_to "", new_challenge_url, :class => "new_challenge_button_new1", :method => :get %>
    
	<%= link_to "MY CHALLENGES >> ", challenges_url , :style=> "text-decoration: none; color:#666666;", :class => "challenge_link1" %>
	
	<%= link_to "#{@challenge.title}","#" , :style=> "text-decoration: none; color:#666666;", :class => "challenge_link1" %> 

</div>
<% if params[:isNewChallenge] == "isNew" %>
    <script> 
      $.dojitsuWallPost.renderFbWallPost();
    </script>
<% end %>
<div id="ch_main_div1">
<%= form_for @challenge do |f| %>
<table width="100%" border="0" border cellspacing=12px>
	<tr>
		<div style="text-transform: uppercase; font-size:25px; margin:0px">
			<font color="orange"><%= on_the_spot_edit @challenge, :title, :type=> :text %></font>
		</div><br>
		<tr>
		<table id="description">
				<tr>
					<td width="15%">
						<b><font color= #999999>DESCRIPTION</font></b></td>
					<td  width="73%">
						<b style="color:#666666;"><%= on_the_spot_edit @challenge,:description , :type=>:textarea  %></b>
					</td>
					<td  width="12%">
						<span id="image1"><%= image_tag("icon_edit.png") %></span>
					</td>
				</tr>
		</table>
		<hr/ width=400px>
	</tr>
	<tr>
            <table>
                <tr>
                    <td width=120px>
                        <b><font color= #999999>START POINT</font></b>
                    </td>
                    <td>
                         <div id="Test" onclick="Testing();">
                              <% if @challenge.start_point.instance_of?PointDateType %>		
                                  <b style="color:#666666;"><%= @challenge.start_point.value.strftime("%b %d, %Y")%> </b>
                              <% else %>							
                                  <%ch = @challenge.start_point  %>
                                  <b style="color:#666666;"><%=  on_the_spot_edit ch,:value, :type=>:text %></b>
                              <% end %>
                         </div>
                         <div id="replaced">
                             <table>
                                  <tr>
                                      <td width="50px;"> 
                                          <div class="styled-select">
                                              <%= select_tag "start_point_type", "<option value='startPointDate'>Date</option><option value='startPointNumber'>Number</option>".html_safe , :required => "required" %>
                                          </div>
                                      </td>  
                                      <td colspan="2">					
                                          <div class="startPointDate">
                                          </div>
                                          <div class="startPointNumber">
                                          </div>				
                                      </td>  
                                  </tr>
                                  <tr>
                                      <td colspan="4">
                                      <%= image_tag("update.png", :class =>"dateUpdate")  %>
                                      <input type="button"  value="CANCEL" onclick="cancel();"  :style ="text-decoration: none; color:#fff; float:right; width: 100px; float:right; margin-right: 0px;"  class = "links_cancel">
                                      </td>
                                  </tr> 
                              </table>
                         </div>
                         <script>
                            $("#replaced").hide();
                            function Testing()
                            {
                                $("#Test").replaceWith($("#replaced").show());
                            }
                            
                            $('.dateUpdate').click(function(){
                                alert("Maisa");
                                var startValue = $("#start_point_value").val();
                                var challengeId = '<%= @challenge.id %>'
                                alert(startValue);
                                alert(challengeId);
                                var obj = {
                                  myParams1:startValue,
                                  myParams2:challengeId
                                };
                                alert(obj);
                                jQuery.support.cors = true;
                                $.get('/challenges/date_update', 
                                        {value:obj},
                                        function(data) {

                                        }, 'script'
                                );
                            });
                            
                         </script>
                    </td>
                    <td></td>
                    <td align="right">
                            <%#=link_to image_tag("icon_edit.png"), date_update_challenges_path(:id => @challenge),:class=>"task_update_popup", :align=>"right" %>
                    </td>
                </tr>
            </table>
		<hr/ width=400px>
	</tr>
	<tr>
		<table>
				<tr> 
					<td width=120px>
						<b><font color= #999999>END POINT</font></b>
					</td>
					<td>
						<% if @challenge.end_point.instance_of?PointDateType %>		
							<b style="color:#666666;"><div id="date"><%= @challenge.end_point.value.strftime("%b %d, %Y") %></div></b>
						<% else %>							
							<b style="color:#666666;"><%= @challenge.end_point.value.to_i %></b>
						<% end %>
					</td>
					<td>
						<%#=link_to image_tag("icon_edit.png"), date_update_challenges_path(:id => @challenge),:class=>"task_update_popup", :style => "text-decoration: underline;",:align=>"right" %>
					</td>
				</tr>
			</table>
		<hr/ width=400px>	
		<br><br>
		<table bg color=#f4f4f4>
			<tr bgcolor="orange">
				<td bgcolor="orange"><font color="white"><b>&nbsp; &nbsp; &nbsp;TASKS</b></font></td>
				
			</tr>
		</table>
	</tr>
	<tr>
		  <div id="ch_main_div2">
			<table  bgcolor=#f4f4f4>
				<tr bgcolor=#f5f5f5>
					<td width="40px">
						<h3 align="left"><font color="#8c8c8c"><b>Total : <%= @challenge.tasks.count %></b></font></h3>
					</td>
					<td>
						<% if @challenge.user_id == current_user.fbauth.uid%>
							<%= link_to image_tag("btn_add_up.png", :style =>"margin-top:3px;" ), add_task_link_challenges_path(:id => @challenge), :class => "addComment add_task_popup" %>
						<% end %>
					</td>
					<td  align="center">
						<% if @challenge.user_id == current_user.fbauth.uid %>
							<font color="#8c8c8c">ADD A TASK</font>
						<% end %>	
					</td>
				</tr>
			<tr bgcolor=#D7D7D7>
  				<td width="90%">
   					<font color="#999999"  ><b>POINT(S)</b></font> <%= image_tag("icon_slash.png", :height => '12', :width => '5') %> <font color="#999999"><b>TASKS</b></font>
  						</td>
  						<td></td>
  							<td width="15%" style="font-weight:bold; text-align:right; color:#999999;">
   								SCORE
  						</td>
 				</tr>
				<% total_score = 0 %>
				<% total_score_count = 0 %>
				<% total = 0 %>
				<% @challenge.tasks.each do |aTask| %>
				<% total += aTask.score.to_i %>
				<tr bgcolor=#ffffff >
					<td id="task_list" colspan="3" >						
						<% if aTask.is_complete.to_i == 0 %>
							<div>
								<div style="float:left; margin-top:15px;"><%= aTask.score %> <%= image_tag("icon_slash.png", :height => '10', :width => '5')%></div><div style="float:left;  margin-top:15px; margin-left:5px;"><%= aTask.name %></div>
								<div class="showperscore_0"><%= link_to "0", task_update_challenges_path(:id => @challenge, :name=>aTask.name, :score=>aTask.score, :score_by=>aTask.score_by) ,:class=>"task_update_popup", :style => "text-decoration: underline; color:#F9AB47;" %></div>
							</div>
						<% else %>	
							<div>
								<% total_score_count +=1 %>
								<div style="float:left; margin-top:15px;"><%= aTask.score %> <%= image_tag("icon_slash.png", :height => '10', :width => '5')%></div><p style="float:left; margin-top:15px; margin-left:5px; text-decoration:line-through;"><%= aTask.name %></p>
								<div class="showperscore"><%= aTask.score %></div>
								<% total_score += aTask.score.to_i %>
							</div>
						<% end %>
						<hr/ width=400px>																																	
					</td>
				</tr>
				
				<% end %>
				<tr bgcolor=#f4f4f4>
					<td colspan="3"></td>
				</tr>
			</table>
			<div style="width=30px">
				My Dojitsu score: <br>
				<div class="task" id="taskprogress"></div>
				<div class="showperscore_personal"><%= total_score %></div>	
				<style>
					.task
					{
						width:790px;
						}
					</style>
					<div id="blackbox_personal">
						<div class="completedtask1">																	
								<%= total_score %> points (<%= total_score_count %> &nbsp; tasks)
						</div>
						<div class="notcompleted1">
									<font size=3 color="#F8981D"><b>to go:</b></font>&nbsp; <font color="#fff"><%= (total-total_score) %> points (<%= @challenge.tasks.count.to_i-total_score_count.to_i %>&nbsp; tasks)</font>
						</div>
						<script type="text/javascript">
								$(function() {
									$("#taskprogress").progressbar({ value: Math.round(((<%= total_score %>/<%= total %>)*100)) });							
									$("<p>").attr("id", "percentage_personal").text($("#taskprogress").progressbar("option", "value") + "% Completed:  ").appendTo("#taskprogress");
								});
						</script>
						<% if @challenge.is_complete != 1 %>
                                                  <%= markAsComplete%>
                                                <% end %>
					</div><br>
				</div>
			
	</tr>		
</table>	

<% end %>	

</div>



<div id="tooltip" class="tooltip">
	
</div>





<script>
	function changeVal(str,score) {
		var tot_score = str*score;
		$("#tatal_s").val(tot_score);
	} 
	// execute your scripts when the DOM is ready. this is a good habit
	$(function() {	
		
		$('.task_update_popup').colorbox();
		$('.add_task_popup').colorbox();
		
		$("#date").dateinput({
			format: 'dddd dd, mmmm yyyy',	// the format displayed for the user
			selectors: true,             	// whether month/year dropdowns are shown
			min: -100,                    // min selectable day (100 days backwards)
			max: 100,                    	// max selectable day (100 days onwards)
			offset: [10, 20],            	// tweak the position of the calendar
			speed: 'fast',               	// calendar reveal speed
			firstDay: 1                  	// which day starts a week. 0 = sunday, 1 = monday etc..
		});
	});
	
	// setup tooltip for a single DIV element
	$("#task_list a").tooltip({
		// each trashcan image works as a trigger
		tip: '#tooltip',

		// custom positioning
		position: 'center right',

		// move tooltip a little bit to the right
		offset: [0, 15],

		// there is no delay when the mouse is moved away from the trigger
		delay: 0
	});
	
</script>