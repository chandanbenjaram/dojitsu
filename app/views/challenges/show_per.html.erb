
<%= stylesheet_link_tag('simple-tabs','datePicker', 'colorbox','jquery-ui', 'ui.core','ui.progressbar','ui.theme', 'main','soc-per')%>

<%= javascript_include_tag('simple-tabs','ui.progressbar','jquery.colorbox-min','jquery.table.addrow','jquery.datePicker','date','on_the_spot','jquery.tools.min','soc-per')%>
<%= render 'layouts/loggedinbody'%>

<div id="ch_main_div">
<div id="ch_main_div1">
<%= form_for @challenge do |f| %>
<%#= debug @challenge %>
<table width="100%" border="0" border cellspacing=12px>
	<tr>
		<div class="title">
			<p class="allcaps"><font color="orange"><%= on_the_spot_edit @challenge, :title, :type=> :text %></p></font></h1></b>
		</div>
		<tr>
		<table border=1px width=500px height=60px bgcolor=white>
			<tr>
				<td width=120px valign="top">
					<b><font color=	#909090>DESCRIPTION</b>
				</td>
				<td class="editable" valign="top">
					<%= on_the_spot_edit @challenge, :description, :type => :textarea %>
				</td>
			</tr>
		</table>
		<hr/ width=400px>
	</tr>
	<tr>
		<table border=1px width=400px height=10px bgcolor=white>
			<tr>
				<td width=120px>
					<b><font color=	#909090>START POINT</font></b>
				</td>
				<td class="editable">					
					<% if @challenge.start_point.instance_of?PointDateType %>		
						<%= @challenge.start_point.value.strftime("%b %d, %Y") %>
					<% else %>							
						<%= @challenge.start_point.value %>
					<% end %>
				</td>
			</tr>
		</table>
		<hr/ width=400px>
	</tr>
	<tr>
		<table border=1px width=400px height=10px bgcolor=white>
			<tr>
				<td width=120px>
					<b><font color=	#909090>END POINT</font></b></td>
				<td class="editable">
					<% if @challenge.end_point.instance_of?PointDateType %>		
						<%= @challenge.end_point.value.strftime("%b %d, %Y") %>
					<% else %>							
						<%= @challenge.end_point.value %>
					<% end %>										
				</td>
			</tr>
		</table>
		<table bg color=#f4f4f4>
			<tr bgcolor="orange">
				<td bgcolor="orange"><font color="white"><b>TASKS</b></font></td>
				<td bgcolor="orange"></td>
			</tr>
		</table>
	</tr>
	<tr>
		<div id="ch_main_div3">
		  <div id="ch_main_div2">
			<table width="100%" border="1" bgcolor=#f4f4f4 >
				<tr bgcolor=#f5f5f5>
					<th width="85%">
						<h3 align="left"><font color="#8c8c8c"><b>Total : <%= @challenge.tasks.count %></b></font></h3>
					</th>
					<th width="3%">
						<%= link_to image_tag("btn_add_up.png", :style =>"margin-top:3px;" ), add_task_link_challenges_path(:id => @challenge), :class => "addComment add_task_popup" %>
					</th>
					<th width="12%">
						<div align="left"><font color="#8c8c8c">ADD A TASK</font> </div>
					</th>
				</tr>
				<tr bgcolor=#D7D7D7>
					<td width="85%">
						<h4 style="margin-top:15px;"><font color="#999999"  style="margin-top:15px;"><b>POINT(s)</b></font> <%= image_tag("icon_slash.png", :height => '12', :width => '5') %> <font color="#999999"><b>TASKS</b></font></h4>
					</td>
					<td>
					</td>
					<td width="15%">
						<h4 style="margin-top:15px;"><p style="float:right; color:#999999;"><b>SCORE</b> </p></h4>
					</td>
				</tr>
				<% total_score = 0 %>
				<% total_score_count = 0 %>
				<% total = 0 %>
				<% @challenge.tasks.each do |aTask| %>
				<% total += aTask.score.to_i %>
				<tr bgcolor=#ffffff>
					<td colspan="3" id="mytable" >						
						<% if aTask.is_complete.to_i == 0 %>
							<div id="task_list">
								<p style="float:left; margin-top:15px;"><%= aTask.score %> <%= image_tag("icon_slash.png", :height => '10', :width => '5')%></p><p style="float:left;  margin-top:15px; margin-left:5px;"><%= aTask.name %></p>
								<div class="showperscore_0"><%= link_to "0", task_update_challenges_path(:id => @challenge, :name=>aTask.name, :score=>aTask.score, :score_by=>aTask.score_by) ,:class=>"task_update_popup", :style => "text-decoration: underline;" %></div>
							</div>
						<% else %>	
							<div id="task_list">
								<% total_score_count +=1 %>
								<p style="float:left; margin-top:15px;"><%= aTask.score %> <%= image_tag("icon_slash.png", :height => '10', :width => '5')%></p><p style="float:left; margin-top:15px; margin-left:5px; text-decoration:line-through;"><%= aTask.name %></p>
								<div class="showperscore"><%= aTask.score %></div>
								<% total_score += aTask.score.to_i %>
							</div>
						<% end %>
						<hr/ width=400px>																																	
					</td>
				</tr>
				
				<% end %>
				<tr bgcolor=#f4f4f4>
					<td colspan="3"></td>
				</tr>
			</table>
			<div>
				My Dojitsu score: <br>
				<div class="task" id="taskprogress"></div>
				<div class="showperscore1"><%= total_score %></div>	
				<style>
					.task
					{
						width:700px;
						}
					</style>
					<div id="check2">
						<div class="completedtask1"> 
								<%= total_score %> points (<%= total_score_count %> &nbsp; tasks)
						</div>
						<div class="notcompleted1">
									<font size=3 color="#F8981D"><b>to go:</b></font>&nbsp; <font color="#fff"><%= (total-total_score) %> points (<%= @challenge.tasks.count.to_i-total_score_count.to_i %>&nbsp; tasks)</font>
						</div>
						<script type="text/javascript">
								$(function() {
									$("#taskprogress").progressbar({ value: Math.round(((<%= total_score %>/<%= total %>)*100)) });							
									$("<p>").attr("id", "check").text($("#taskprogress").progressbar("option", "value") + "% Completed:  ").appendTo("#taskprogress");
								});
						</script>
						<%= link_to "MARK AS COMPLETED",  challenge_comp_challenges_path(:id=>@challenge), :style => "text-decoration: none; color:#fff; float:right" ,:class => "challenge_mark_as_c"%>
					</div>
				</div>
				</div >
			</div >
	</tr>		
</table>	

<% end %>	

</div>
</div>


<div id="tooltip" class="tooltip">
	
</div>

<script type="text/javascript">
	
	function cal(str, strr)
	{
		alert("enter value=="+str);
		alert("enter value=="+strr);
	}

</script>




<script>

function changeVal(str,score) {
	var tot_score = str*score;
	$("#tatal_s").val(tot_score);
} 

	
	$('.task_update_popup').colorbox();
	$('.add_task_popup').colorbox();

// execute your scripts when the DOM is ready. this is a good habit
$(function() {
	// setup tooltip for a single DIV element
	$("#mytable a").tooltip({
		// each trashcan image works as a trigger
		tip: '#tooltip',

		// custom positioning
		position: 'center right',

		// move tooltip a little bit to the right
		offset: [0, 15],

		// there is no delay when the mouse is moved away from the trigger
		delay: 0
	});	
});
</script>






