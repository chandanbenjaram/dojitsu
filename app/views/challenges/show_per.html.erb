
<%= stylesheet_link_tag('simple-tabs','datePicker', 'colorbox','jquery-ui', 'ui.core','ui.progressbar','ui.theme', 'main')%>
<%= javascript_include_tag :defaults %>
<%= javascript_include_tag('simple-tabs','ui.progressbar','jquery.colorbox-min','jquery.table.addrow','jquery.datePicker','date','jquery.editable-1.3.3','on_the_spot','jquery.ezpz_tooltip','jquery.ezpz_tooltip.min.js','jquery.tools.min')%>
<%= render 'layouts/loggedinbody'%>

<div id="ch_main_div">
<div id="ch_main_div1">
<%= form_for @challenge do |f| %>
<%#= debug @challenge %>
<table width="100%" border="0" border cellspacing=12px>
	<tr>
		<div class="title">
			<p class="allcaps"><font color="orange"><%= on_the_spot_edit @challenge, :title, :type=> :text %></p></font></h1></b>
		</div>
		<tr>
		<table border=1px width=500px height=60px bgcolor=white>
			<tr>
				<td width=120px valign="top">
					<b><font color=	#909090>DESCRIPTION</b>
				</td>
				<td class="editable" valign="top">
					<%= on_the_spot_edit @challenge, :description, :type => :textarea %>
				

				</td>
			</tr>
		</table>
		<hr/ width=400px>
	</tr>
	<tr>
		<table border=1px width=400px height=10px bgcolor=white>
			<tr>
				<td width=120px>
					<b><font color=	#909090>START POINT</font></b>
				</td>
				<td class="editable">
					<% if @challenge.start_point.type.to_s == "PointDateType" %>		
						<%= @challenge.start_point.value.strftime("%b %d, %Y") %>
					<% else %>							
						<%= @challenge.start_point.value %>
					<% end %>
				</td>
			</tr>
		</table>
		<hr/ width=400px>
	</tr>
	<tr>
		<table border=1px width=400px height=10px bgcolor=white>
			<tr>
				<td width=120px>
					<b><font color=	#909090>END POINT</font></b></td>
				<td class="editable">
					<% if @challenge.end_point.type.to_s == "PointDateType" %>		
						<%= @challenge.end_point.value.strftime("%b %d, %Y") %>
					<% else %>							
						<%= @challenge.end_point.value %>
					<% end %>										
				</td>
			</tr>
		</table>
		<table bg color=#f4f4f4>
			<tr bgcolor="orange">
				<td bgcolor="orange"><font color="white"><b>TASKS</b></font></td>
				<td bgcolor="orange"></td>
			</tr>
		</table>
	</tr>
	<tr>
		<div id="ch_main_div3">
		  <div id="ch_main_div2">
			<table width="100%" border="1" bgcolor=#f4f4f4 >
				<tr bgcolor=#f5f5f5>
					<th width="85%">
						<h3 align="left"><font color="#8c8c8c"><b>Total : <%= @challenge.tasks.count %></b></font></h3>
					</th>
					<th width="3%">
						<%= link_to image_tag("btn_add_up.png", :style =>"margin-top:3px;" ), add_task_link_challenges_path(:id => @challenge), :class => "addComment add_task_popup" %>
					</th>
					<th width="12%">
						<div align="left"><font color="#8c8c8c">ADD A TASK</font> </div>
					</th>
				</tr>
				<tr bgcolor=#D7D7D7>
					<td width="85%">
						<h4 style="margin-top:15px;"><font color="#999999"  style="margin-top:15px;"><b>POINT(s)</b></font> <%= image_tag("icon_slash.png", :height => '12', :width => '5') %> <font color="#999999"><b>TASKS</b></font></h4>
					</td>
					<td>
					</td>
					<td width="15%">
						<h4 style="margin-top:15px;"><p style="float:right; color:#999999;"><b>SCORE</b> </p></h4>
					</td>
				</tr>
				<% total_score = 0 %>
				<% total_score_count = 0 %>
				<% total = 0 %>
				<% @challenge.tasks.each do |aTask| %>
				<% total += aTask.score.to_i %>
				<tr bgcolor=#ffffff>
					<td colspan="3"  id="mytable" >
						<% if aTask.is_complete.to_i == 0 %>
							<div id="task_list">
								<p style="float:left; margin-top:15px;"><%= aTask.score %> <%= image_tag("icon_slash.png", :height => '10', :width => '5')%></p><p style="float:left;  margin-top:15px; margin-left:5px;"><%= aTask.name %></p>
								<div class="showperscore_0"><%= link_to "0", task_update_challenges_path(:id => @challenge, :name=>aTask.name, :score=>aTask.score, :score_by=>aTask.score_by) ,:class=>"task_update_popup", :style => "text-decoration: underline;" %></div>
							</div>
						<% else %>	
							<div id="task_list">
								<% total_score_count +=1 %>
								<p style="float:left; margin-top:15px;"><%= aTask.score %> <%= image_tag("icon_slash.png", :height => '10', :width => '5')%></p><p style="float:left; margin-top:15px; margin-left:5px; text-decoration:line-through;"><%= aTask.name %></p>
								<div class="showperscore"><%= aTask.score %></div>
								<% total_score += aTask.score.to_i %>
							</div>
						<% end %>
						<hr/ width=400px>																																	
					</td>
				</tr>
				<% end %>
				<tr bgcolor=#f4f4f4>
					<td colspan="3"></td>
				</tr>
			</table>
			<table bgcolor=#f4f4f4>
				<tr bgcolor=#ffffff>
					<td colspan="2" >
					  My Dojitsu score: <br>					  
					  <b><h4><font color="green"><%= total_score_count %></b></font> <font color="black"><b>completed,</b></font>
				      <b><font color="orange"><%= @challenge.tasks.count.to_i-total_score_count.to_i %></b></font> <font color="black"><b>remaining</b></font></h4>
					</td>
					<td width="13%">
						<div class="showperscore"><%= total_score %></div>						
					</td>
				</tr>
				<tr bgcolor=#ffffff>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr bgcolor=#f4f4f4>
					<td></td>
					<td colspan="2">
						<%= link_to "MARK AS COMPLETED",  challenge_comp_challenges_path(:id=>@challenge), :style => "text-decoration: none; color:#fff; float:right" ,:class => "challenge_mark_as_c"%>
					</td>
				</tr>
			</table>
		  </div >
		</div >
	</tr>		
</table>	
<% end %>	
</div>
</div>


<div id="tooltip" class="tooltip">
	
</div>



<script type="text/javascript" language="JavaScript">
function changeVal(str,score) {
	var tot_score = str*score;
	$("#tatal_s").val(tot_score);
} 
</script>

<script>
	
	$('.task_update_popup').colorbox();
	$('.add_task_popup').colorbox();
	
// execute your scripts when the DOM is ready. this is a good habit
$(function() {
	// setup tooltip for a single DIV element
	$("#mytable a").tooltip({
		// each trashcan image works as a trigger
		tip: '#tooltip',

		// custom positioning
		position: 'center right',

		// move tooltip a little bit to the right
		offset: [0, 15],

		// there is no delay when the mouse is moved away from the trigger
		delay: 0
	});	
});
</script>



<script type="text/javascript">

<script type="text/javascript" src="/js/jquery.js"></script>
<script type="text/javascript" src="/js/jquery.defaultText.js"></script>
<script type="text/javascript" src="/js/jquery.table.addrow.js"></script>
<script type="text/javascript">
	$("document").ready(function(){
		$(".addComment").btnAddRow({rowNumColumn:"rowNumber"}),
		$(".delRow").btnDelRow()						
	});
	
	// Jquery part
	jQuery(document).ready(function($) {
 	// to get date on click
	$(":date").dateinput({
		format: 'dddd dd, mmmm yyyy',	// the format displayed for the user
		selectors: true,             	// whether month/year dropdowns are shown
		min: -100,                    // min selectable day (100 days backwards)
		max: 100,                    	// max selectable day (100 days onwards)
		offset: [10, 20],            	// tweak the position of the calendar
		speed: 'fast',               	// calendar reveal speed
		firstDay: 1                  	// which day starts a week. 0 = sunday, 1 = monday etc..
	});

	// edit a text on the spot 
	$(".editable").editable("http://www.example.com/save.php", { 
    	method : "PUT"
	});

	$(".editable").editable("http://www.example.com/save.php", { 
    	settings.submit : '<button type="submit">Save</button>'
	});

	$(".editable").editable("http://www.example.com/save.php", { 
    	settings.submit : 'Save'
	});
 	
	$('.editable1').editable({
    	type:'text',
    	submit:'update',
    	cancel:'cancel',
    	editClass:'resultItem',
    	onSubmit:end
    }); 
	
	// edit on spot 2 nd type
	$('.editable2').editable({type:'textarea',submitBy:'dblclick'}).css('background-color','#39c');
	
	$(function(){
    	$('.editable1').editable({onEdit:begin});
    	function begin(){
    		this.append('Click somewhere else to submit');
    	}
    }); 
      
	$('.editable3').editable({
    	type:'text',
    	submit:'save',
    	onSubmit:end
    }); 

	$('div.editable').editable()
	
	$(function(){
    	$('.editable1').editable({onEdit:begin});
    	function begin(){
    		this.append('Click somewhere else to submit');
    	}
    }); 
	
	// Add row for new task
	//alert("hiiiiiiiii");
	$(".alternativeRow").btnAddRow({oddRowCSS:"oddRow",evenRowCSS:"evenRow"});
	$(".delRow").btnDelRow();
	
	// Date Picker scripting code
	//alert("Date picker is working");
	$('.date-pick').datePicker({startDate:'01/01/1996'});

    $('#ch_st_date').change(function() {
		console.debug('changed...' + $(this));

	});
	
	$('#ch_ed_date').change(function() {
		console.debug('changed...' + $(this));

	});
	
	$('.chall_type').click(function(){
		if ($(this).attr("id") == "challenge_cha_type_per")
		{
			//alert($(this).attr("id"));
			$("#challenge_cha_type_per_div").show("fast");
			$("#challenge_cha_type_soc_div").hide("fast");
		}
		else
		{
			//alert($(this).attr("id"));
			$("#challenge_cha_type_soc_div").show("fast");
			$("#challenge_cha_type_per_div").hide("fast");
		}
		//$("<div></div>").appendTo("div#new_tsk_field");
	});
	
	/*
	$('#ch_ed_date').change(function() {
		var sel_val = $(this).val();
		//alert("new"+sel_val);
		//$('#ch_st_date').hide();
		if ($(this).val() == "#ch_ed_dat")
		{
			//alert("date");
			$(sel_val).show();
			$('#ch_ed_num').hide();	
		}
		else
		{
			//alert("number");
			$(sel_val).show();
			$('#ch_ed_dat').hide();
		}

	});
	
	$('#ch_ed_date').change(function() {
	var sel_val = $(this).val();
	//alert(""+sel_val);
	//$('#ch_ed_date').hide();
	$(sel_val).show();
	});
	*/

});
$('.editable2').editable({type:'textarea',submitBy:'dblclick'}).css('background-color','#39c');
</script>

<script>
$(document).ready(function() {  
 
    //select all the a tag with name equal to modal
    $('a[name=modal]').click(function(e) {
        //Cancel the link behavior
        e.preventDefault();
        //Get the A tag
        var id = $(this).attr('href');
     
        //Get the screen height and width
        var maskHeight = $(document).height();
        var maskWidth = $(window).width();
     
        //Set height and width to mask to fill up the whole screen
        $('#mask').css({'width':maskWidth,'height':maskHeight});
         
        //transition effect     
        $('#mask').fadeIn(1000);    
        $('#mask').fadeTo("slow",0.8);  
     
        //Get the window height and width
        var winH = $(window).height();
        var winW = $(window).width();
               
        //Set the popup window to center
        $(id).css('top',  winH/2-$(id).height()/2);
        $(id).css('left', winW/2-$(id).width()/2);
     
        //transition effect
        $(id).fadeIn(2000); 
     
    });
     
    //if close button is clicked
    $('.window .close').click(function (e) {
        //Cancel the link behavior
        e.preventDefault();
        $('#mask, .window').hide();
    });     
     
    //if mask is clicked
    $('#mask').click(function () {
        $(this).hide();
        $('.window').hide();
    });   

		
		//id is the ID for the DIV you want to display it as modal window
  launchWindow(id); 
  
  
  $(document).keyup(function(e) {
  if(e.keyCode == 13) {
    $('#mask').hide();
    $('.window').hide();
  }
});
     
});
 
</script>

<style type="text/css">
.atable{
	border-collapse:collapse;
	border:1px solid #AAA;
	width:97%;
}
.topcalss {
	background-color: gray;

}
.atable th{
	border:1px solid #AAF;
	background:#ADD8E6;
	font-weight:bold;
}

.atable td{
	padding:4px;
	border:1px solid #AAF;
}

.oddRow{
	background:#FFFFFF;
}

.evenRow{
	background:#F0F8FF;
}
.allcaps {
	font-variant: small-caps;
	text-transform: uppercase;
	font-family:"Gothem Book","Arial";
	font-size:20px;
}

#ch_main_div {
    border-color: #F4F4F4;
    border-radius: 5px 5px 5px 5px;
    border-style: solid;
    border-width: 10px;
    margin-top: 25px;
}

#ch_main_div1{
	border-width:30px;
  	border-style:solid;
    border-radius: 15px 15px 15px 15px;
  	border-color:#ffffff;
	margin-top:10px;
	-moz-border-radius:    5px;
    -webkit-border-radius: 5px;
    border-radius:         5px;
}

#ch_main_div3{
	border-width:2px;
  	border-style:solid;
  	border-color:grey;
}

#ch_main_div2{
	border-width:10px;
  	border-style:solid;
  	border-color:#f4f4f4;
	background-color:#fffff
}

div.htmltooltip{
	position: absolute; /*leave this and next 3 values alone*/
	z-index: 1000;
	left: -1000px;
	top: -1000px;
	background: #272727;
	border: 10px solid black;
	color: white;
	padding: 3px;
	width: 250px; /*width of tooltip*/
}

</style>


<style>
 
/* Z-index of #mask must lower than #boxes .window */
#mask {
  position:absolute;
  left:0;
  top:0;
  z-index:9000;
  background-color:#999999;
  display:none;
}
   
#boxes .window {
  position:absolute;
  top:90px;
  width:440px;
  height:200px;
  display:none;
  z-index:9999;
  padding:20px;
}
 
 
/* Customize your modal window here, you can add background image too */
#boxes #dialog {
  width:375px; 
  height:203px;
  padding:10px;
  background-color:#ffffff;
}
</style>