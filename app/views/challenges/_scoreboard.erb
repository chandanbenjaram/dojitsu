<%= javascript_include_tag('ui.progressbar')%>
<%= stylesheet_link_tag('jquery-ui', 'ui.progressbar','ui.theme','scoreboard')%>
<%#=  debug  Challenge.scoreboard(params[:id])  %>

<% @totalChallegne = 1 %>
<%#= current_user.fbauth.uid %>
<% if @challenge.instance_of?ChildChallenge %>
  <% @parentChallenge = Challenge.where(:_id => @challenge.challenge_id).first%>
  <% abtTatal = @parentChallenge.child_challenges.count %>
  <% @totalChallegne = abtTatal +1 %>    
<% else %>
  <% abtTatal = @challenge.child_challenges.count %>
  <% @totalChallegne = abtTatal +1 %>    
<% end %>

<% percentage1 = 0 %>
<% tasks1=0%>
<% score_total1 = 0 %>
<% total_score1 = 0 %>
<% remaining_score1 = 0 %>
<% total_score_count1 = 0 %>
<% total1 = 0 %>
<% @challenge.tasks.each do |aTask| %>
  <% tasks1+=1 %>
  <% total1 += aTask.score.to_i %>
  <% if aTask.is_complete.to_i == 0 %>
    <% remaining_score1+= aTask.score.to_i %>
  <% else %>	
    <% total_score1 += aTask.score.to_i %>
    </div>
  <% end %>
<% end %>   

    <div>
<table>
  <td width="50%">
    <span id ="participant_score"> <%= @totalChallegne %> Participants</span>
  </td>
  <td width="30%">
    <input type="text" id="search"/>
  </td>
  <td width="15%">
    <section class="styled-select" >
      <select id="select" onchange="displayOne('myTable1', this.selectedIndex);">
        <option value="All" id="select">ALL</option>
        <option value="Winners" id="select">Winners</option>
        <option value="Top Ten" id="select">Top Ten</option>
        <option value="My Friends" id="select">My Friends</option>
        <option value="My Competitors" id="select">My Competitors(10 people before and/or after me)</option>
      </select> 
    </section>
  </td>
  <td width="5%">
    <%= image_tag ("searchbutton.PNG") ,:id=>"search_button"%>
  </td>

</table></div>
  <script type="text/javascript" >
    $(document).ready(function() 
    { 
      $("#myTable1").tablesorter({ 
        // define a custom text extraction function 
        textExtraction: function(node) { 
          // extract data from markup and return it 
          if (node.innerHTML.indexOf("%") != -1)
          {
            return node.innerHTML.replace("%","");
          }
          return node.innerHTML; 
        } 
      }); 
    } 
  ); </script>

  <script language="javascript" type="text/javascript">
    //<![CDATA[
    var table12_Props = {
      highlight_keywords: true,
      on_keyup: true,
      on_keyup_delay: 1500,
      single_search_filter: true,
      selectable: true
    };
    var tf12 = setFilterGrid( "myTable1",table12_Props );
    //]]>
  </script>


  <div id="container">
    <!-- All -->
    <div class="showhide" id="myTable10" name="myTable10" style="top:-5px;">

      <table id="myTable1 " class='tablesorter1' width="100%">   
        
        <tr id="sTable">
          <th width="8%">Rank</th>
          <th width="23%">Contestants</th>
          <th width="8%"></th>
          <th width="45%">Achievement</th>
          <th width="17%">Time</th>
        </tr>    


        <tbody>
          <% @flag = 1 %>
          <% @latestScore = 1 %>
          <% lastUpdate = @challenge.created_at %>
          <% Challenge.scoreboard(params[:id]).each do |listOfAll| %>
            <tr>
              <td class="bordercolor">
                <% unless listOfAll[1] == 0 %>
                  <% if @flag == 1 %>
                    <%= image_tag("gold.png") %>
                    gold
                    <% @latestScore = listOfAll[1] %>
                    <% @flag += 1 %>
                  <% elsif @flag == 2 %>
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("gold.png") %>
                      gold
                    <% else %>
                      <%= image_tag("silver.png") %>
                      silver
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %>              
                  <% elsif @flag == 3 %>              
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("silver.png") %>
                      silver
                    <% else %>
                      <%= image_tag("brozone.png") %>
                      bronze
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %> 
                  <% elsif @flag == 4 %>
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("brozone.png") %>
                      bronze
                    <% else %>
                      <%= image_tag("blue.png") %>
                      blue
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %>                
                  <% elsif @flag == 5 %>
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("blue.png") %>
                      blue
                    <% else %>
                      <%= image_tag("red.png") %>
                      red
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %>                
                  <% elsif @flag == 6 %>
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("red.png") %>
                      red
                    <% else %>
                      <%= image_tag("platinum.png") %>
                      platinum
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %>                
                  <% else %>

                  <% end %>            
                <% else %>

                <% end %>     
              </td>
              <td class="bordercolor">
                <%= FbGraph::User.new(listOfAll[0]).fetch.name %><br>
                <%= image_tag(FbGraph::User.new(listOfAll[0]).fetch.picture) %>
              </td>
              <td class="bordercolor">
                <section id="taskpercentages">
                  <section id="taskpercentage<%= listOfAll[0] %>">

                  </section>            
                </section>
              </td>
              <td class="bordercolor">
                <% eachChallenge = Challenge.all(conditions: {:user_id => listOfAll[0], :title=>@challenge.title}).first %>
                <% total_score = 0 %>
                <% total_score_count = 0 %>
                <% total = 0 %>              
                <% eachChallenge.tasks.each do |aTask| %>
                  <% total += aTask.score.to_i %>
                  <% if (aTask.is_complete == 1 ) %>
                    <% total_score+=Integer(aTask.score) %>  
                    <% total_score_count += 1 %>                  
                    <% if lastUpdate.to_i < aTask.updated_at.to_i %>                        
                      <% lastUpdate = aTask.updated_at %>
                    <% end %>                     
                  <% end %>
                <%end%>             
                <section style="width:110%">                
                  <section class="task" id="taskprogress<%= eachChallenge.user_id %>"></section>
                  <section class="sshowperscore_personal"></section>	
                  <section id="sblackbox_personal">
                    <section class="snotcompleted2">
                      <span class="tasks_color"><%= (total-total_score) %></span> <span class="show_scoreboard_span">points (<%= eachChallenge.tasks.count.to_i-total_score_count.to_i %>&nbsp; tasks)</span>
                    </section>                   
                  </section>
                  <br>
                </section>

                <script type="text/javascript">
           
                  $(function() {
                    $("#taskprogress<%= eachChallenge.user_id %>").progressbar({ value: Math.round(((<%= total_score %>/<%= total %>)*100)) });							
             
                      $("<p>").attr("id", "sspercentage_personal").text($("#taskprogress<%= eachChallenge.user_id %>").progressbar("option", "value")+ "%"   ).appendTo("#taskpercentage<%= eachChallenge.user_id %>");
            
                    });
                </script>
              </td>
              <td class="bordercolor">        		
                <% diffTime = lastUpdate.to_i %>
                <% if diffTime > 8640 %>
                  <%= lastUpdate.strftime("%b %d, %Y") %>	
                <% else %>
                  <%= time_ago_in_words  lastUpdate %>
                <% end %>        
              </td>
            </tr>
            <% lastUpdate = @challenge.created_at %>
          <% end %>  
        </tbody>
      </table>
      <% if @challenge.is_complete != 1 %>
        <table style="margin-top: -70px;">
          <tr>
            <td colspan="5">    		
              <%= link_to "I'm Done with this challenge >> Submit my score: #{total_score1} ", challenge_comp_challenges_path(:id=>@challenge.id) , :class => "links_score_p" %>
            </td>
          </tr>
        </table>
      <% end %>	
      <a class="tlink" href="#">[Top]</a><br>&nbsp;</div>










    <!-- Winners  -->
    <% if @challenge.instance_of?ChildChallenge %>
      <% @fetChallenge = Challenge.where(:_id => @challenge.challenge_id).first%>
    <% else %>
      <% @fetChallenge = Challenge.where(:_id => params[:id]).first%>
    <% end %>
    <div class="showhide" id="myTable11" name="myTable11" style="margin-top:90px;">
      <% if @fetChallenge.is_complete == 1 %>
        <table id="myTable1" class='tablesorter1' width="100%">   

          <tr id="sTable">
            <th width="8%">Rank</th>
            <th width="23%">Contestants</th>
            <th width="8%"></th>
            <th width="45%">Achievement</th>
            <th width="17%">Time</th>
          </tr>    

          <% @flag = 1 %>
          <% @latestScore = 1 %>
          <% sl=0 %>
          <% if @fetChallenge.social_type.who_win == "Highest number of points" %>
            <% @all =  Challenge.winner(@fetChallenge.id) %>
          <% end %>
          <% if @fetChallenge.social_type.who_win == "Participant completes all tasks" %>
            <% @all =  Challenge.winnerCompleteAllTask(@fetChallenge.id) %>
          <% end %>
          <% if @fetChallenge.social_type.who_win == "Lowest number of points" %>
            <% @temp =  Challenge.winner(@fetChallenge.id) %>
            <% @all = @temp.sort {|a,b| a[1] <=> b[1]} %>
          <% end %>			
          <% if @fetChallenge.social_type.who_win == "1st person to reach End Point" %>
            <% @temp =  Challenge.winnerFirstPersonReach(@fetChallenge.id) %>
            <% @all = @temp.sort {|a,b| a[1] <=> b[1]} %>
          <% end %>
          <% @allParticipants = [] %>
          <% @allWinners = [] %>
          <% @all.each do |aWinner,index| %>
            <% @allParticipants.push(aWinner) %>
          <% end %>
          <% @all %>					  						
          <% @all.each do |aWinner,index| %>
            <% @allWinners.push(aWinner) %>						
            <% if Challenge.all(conditions: {:user_id => aWinner, :challenge_id=>@fetChallenge.id}).first %>
              <% eachChallenge = Challenge.all(conditions: {:user_id => aWinner, :challenge_id=>@fetChallenge.id}).first %>
            <% else %>
              <% eachChallenge = Challenge.all(conditions: {:user_id => aWinner, :_id=>@fetChallenge.id}).first %>
            <% end %>						
    <%# eachChallenge = Challenge.all(conditions: {:user_id => aWinner, :title=>@fetChallenge.title}).first %>				    
            <tr>
              <td class="bordercolor">
                <% unless index == 0 %>
                  <% if @flag == 1 %>
                    <%= image_tag("gold.png") %>
                    gold
                    <% @latestScore = index %>
                    <% @flag += 1 %>
                  <% elsif @flag == 2 %>
                    <% if @latestScore == index %>
                      <%= image_tag("gold.png") %>
                      gold
                    <% else %>
                      <%= image_tag("silver.png") %>
                      silver
                      <% @latestScore = index %>
                      <% @flag += 1 %>
                    <% end %>              
                  <% elsif @flag == 3 %>              
                    <% if @latestScore == index %>
                      <%= image_tag("silver.png") %>
                      silver
                    <% else %>
                      <%= image_tag("brozone.png") %>
                      bronze
                      <% @latestScore = index %>
                      <% @flag += 1 %>
                    <% end %> 
                  <% elsif @flag == 4 %>
                    <% if @latestScore == index %>
                      <%= image_tag("brozone.png") %>
                      bronze
                    <% else %>
                      <%= image_tag("blue.png") %>
                      blue
                      <% @latestScore = index %>
                      <% @flag += 1 %>
                    <% end %>                
                  <% elsif @flag == 5 %>
                    <% if @latestScore == index %>
                      <%= image_tag("blue.png") %>
                      blue
                    <% else %>
                      <%= image_tag("red.png") %>
                      red
                      <% @latestScore = index %>
                      <% @flag += 1 %>
                    <% end %>                
                  <% elsif @flag == 6 %>
                    <% if @latestScore == index %>
                      <%= image_tag("red.png") %>
                      red
                    <% else %>
                      <%= image_tag("platinum.png") %>
                      platinum
                      <% @latestScore = index %>
                      <% @flag += 1 %>
                    <% end %>                
                  <% else %>

                  <% end %>            
                <% end %>     
              </td>
              <td class="bordercolor">
                <%=image_tag(FbGraph::User.new(aWinner).fetch.picture) %> 
                <%= FbGraph::User.new(aWinner).fetch.name %>
              </td>
              <td class="bordercolor">
                <div align="center">
                  <section id="taskpercentages">
                    <section id="winnerListProgressPercentage<%= aWinner %>">				
                    </section>            
                  </section>
                </div>
              </td>
              <td style="padding-top:5px;" class="bordercolor">  															
                <% total_score = 0 %>
                <% total_score_count = 0 %>
                <% total = 0 %>              
                <% eachChallenge.tasks.each do |aTask| %>
                  <% total += aTask.score.to_i %>
                  <% if (aTask.is_complete == 1 ) %>
                    <% total_score+=Integer(aTask.score) %>  
                    <% total_score_count += 1 %>                  				                       
                  <% end %>
                <%end%>											            
                <section >                
                  <section class="task" id="winnerListProgress<%= aWinner %>"></section>
                  <section id="sblackbox_personal">
                    <section class="snotcompleted2">
                      <span class="tasks_color"><%= total_score %></span> <font color="#7AC142" weight="bold" size="4px">points (<%= total_score_count %>&nbsp; tasks)</font>
                    </section>                   
                  </section>
                  <br>
                </section>	
                <script type="text/javascript">
                    $(function() {
                      $("#winnerListProgress<%= aWinner %>").progressbar({ value: Math.round(((<%= total_score %>/<%= total %>)*100)) });
                        $("<p>").attr("id", "aspercentage_personal").text($("#winnerListProgress<%= aWinner %>").progressbar("option", "value") + "%").appendTo("#winnerListProgressPercentage<%= aWinner %>");
                      });
                </script>
              </td> 
              <td class="bordercolor">        		
                <% diffTime = lastUpdate.to_i %>
                <% if diffTime > 8640 %>
                  <%= lastUpdate.strftime("%b %d, %Y") %>	
                <% else %>
                  <%= time_ago_in_words  lastUpdate %>
                <% end %>        
              </td>				           
            </tr>	
            <tr>					
            </tr>
            <% sl +=1 %>
            <% if sl.to_i == @challenge.social_type.how_many_winners.to_i %>
              <% break %>
            <% end %>                                  
          <% end %>								  
        </table>
        <% if @challenge.is_complete != 1 %>
          <table style="margin-top: -70px;">
            <tr>
              <td colspan="5">    		
                <%= link_to "I'm Done with this challenge >> Submit my score: #{total_score1} ", challenge_comp_challenges_path(:id=>@challenge.id) , :class => "links_score_p" %>
              </td>
            </tr>
          </table>
        <% end %> 
        <a class="tlink" href="#">[Top]</a><br>&nbsp;
      <% else %>
        Winner list is not declared!
      <% end %>
    </div>





    <!-- Topten  -->
    <div class="showhide" id="myTable12" name="myTable12" style="margin-top:90px;">
      <table id="myTable1" class='tablesorter1' width="100%">   

        <tr id="sTable">
          <th width="8%">Rank</th>
          <th width="23%">Contestants</th>
          <th width="8%"></th>
          <th width="45%">Achievement</th>
          <th width="17%">Time</th>
        </tr>    

        <% if @challenge.instance_of?ChildChallenge %>
          <% @fetChallenge = Challenge.where(:_id => @challenge.challenge_id).first%>
        <% else %>
          <% @fetChallenge = Challenge.where(:_id => params[:id]).first%>
        <% end %>
        <% @flag = 1 %>
        <% @latestScore = 1 %>
        <% sl=0 %>
        <% if @fetChallenge.social_type.who_win == "Highest number of points" %>
          <% @all =  Challenge.winner(@fetChallenge.id) %>
        <% end %>
        <% if @fetChallenge.social_type.who_win == "Participant completes all tasks" %>
          <% @all =  Challenge.winnerCompleteAllTask(@fetChallenge.id) %>
        <% end %>
        <% if @fetChallenge.social_type.who_win == "Lowest number of points" %>
          <% @temp =  Challenge.winner(@fetChallenge.id) %>
          <% @all = @temp.sort {|a,b| a[1] <=> b[1]} %>
        <% end %>			
        <% if @fetChallenge.social_type.who_win == "1st person to reach End Point" %>
          <% @temp =  Challenge.winnerFirstPersonReach(@fetChallenge.id) %>
          <% @all = @temp.sort {|a,b| a[1] <=> b[1]} %>
        <% end %>
        <% @allParticipants = [] %>
        <% @allWinners = [] %>
        <% @all.each do |aWinner,index| %>
          <% @allParticipants.push(aWinner) %>
        <% end %>
        <% @all %>					  						
        <% @all.each do |aWinner,index| %>
          <% @allWinners.push(aWinner) %>						
          <% if Challenge.all(conditions: {:user_id => aWinner, :challenge_id=>@fetChallenge.id}).first %>
            <% eachChallenge = Challenge.all(conditions: {:user_id => aWinner, :challenge_id=>@fetChallenge.id}).first %>
          <% else %>
            <% eachChallenge = Challenge.all(conditions: {:user_id => aWinner, :_id=>@fetChallenge.id}).first %>
          <% end %>						
  <%# eachChallenge = Challenge.all(conditions: {:user_id => aWinner, :title=>@fetChallenge.title}).first %>				    
          <tr>
            <td class="bordercolor">
              <% unless index == 0 %>
                <% if @flag == 1 %>
                  <%= image_tag("gold.png") %>
                  gold
                  <% @latestScore = index %>
                  <% @flag += 1 %>
                <% elsif @flag == 2 %>
                  <% if @latestScore == index %>
                    <%= image_tag("gold.png") %>
                    gold
                  <% else %>
                    <%= image_tag("silver.png") %>
                    silver
                    <% @latestScore = index %>
                    <% @flag += 1 %>
                  <% end %>              
                <% elsif @flag == 3 %>              
                  <% if @latestScore == index %>
                    <%= image_tag("silver.png") %>
                    silver
                  <% else %>
                    <%= image_tag("brozone.png") %>
                    bronze
                    <% @latestScore = index %>
                    <% @flag += 1 %>
                  <% end %> 
                <% elsif @flag == 4 %>
                  <% if @latestScore == index %>
                    <%= image_tag("brozone.png") %>
                    bronze
                  <% else %>
                    <%= image_tag("blue.png") %>
                    blue
                    <% @latestScore = index %>
                    <% @flag += 1 %>
                  <% end %>                
                <% elsif @flag == 5 %>
                  <% if @latestScore == index %>
                    <%= image_tag("blue.png") %>
                    blue
                  <% else %>
                    <%= image_tag("red.png") %>
                    red
                    <% @latestScore = index %>
                    <% @flag += 1 %>
                  <% end %>                
                <% elsif @flag == 6 %>
                  <% if @latestScore == index %>
                    <%= image_tag("red.png") %>
                    red
                  <% else %>
                    <%= image_tag("platinum.png") %>
                    platinum
                    <% @latestScore = index %>
                    <% @flag += 1 %>
                  <% end %>                
                <% else %>

                <% end %>            
              <% end %>     
            </td>
            <td class="bordercolor">
              <%=image_tag(FbGraph::User.new(aWinner).fetch.picture) %> 
              <%= FbGraph::User.new(aWinner).fetch.name %>
            </td>
            <td class="bordercolor">
              <div align="center">
                <section id="taskpercentages">
                  <section id="winnerListProgressPercentageTopTen<%= aWinner %>">				
                  </section>            
                </section>
              </div>
            </td>
            <td style="padding-top:5px;" class="bordercolor">  															
              <% total_score = 0 %>
              <% total_score_count = 0 %>
              <% total = 0 %>              
              <% eachChallenge.tasks.each do |aTask| %>
                <% total += aTask.score.to_i %>
                <% if (aTask.is_complete == 1 ) %>
                  <% total_score+=Integer(aTask.score) %>  
                  <% total_score_count += 1 %>                  				                       
                <% end %>
              <%end%>											            
              <section >                
                <section class="task" id="winnerListProgressTopTen<%= aWinner %>"></section>
                <section id="sblackbox_personal">
                  <section class="snotcompleted2">
                    <span class="tasks_color"><%= total_score %></span> <font color="#7AC142" weight="bold" size="4px">points (<%= total_score_count %>&nbsp; tasks)</font>
                  </section>                   
                </section>
                <br>
              </section>	
              <script type="text/javascript">
                    $(function() {
                      $("#winnerListProgressTopTen<%= aWinner %>").progressbar({ value: Math.round(((<%= total_score %>/<%= total %>)*100)) });
                        $("<p>").attr("id", "aspercentage_personal").text($("#winnerListProgressTopTen<%= aWinner %>").progressbar("option", "value") + "%").appendTo("#winnerListProgressPercentageTopTen<%= aWinner %>");
                      });
              </script>
            </td> 
            <td class="bordercolor">        		
              <% diffTime = lastUpdate.to_i %>
              <% if diffTime > 8640 %>
                <%= lastUpdate.strftime("%b %d, %Y") %>	
              <% else %>
                <%= time_ago_in_words  lastUpdate %>
              <% end %>        
            </td>				           
          </tr>	
          <tr>					
          </tr>
          <% sl +=1 %>
          <% if sl.to_i == 10 %>
            <% break %>
          <% end %>                                  
        <% end %>								  

      </table>
      <% if @challenge.is_complete != 1 %>
        <table style="margin-top: -70px;">
          <tr>
            <td colspan="5">    		
              <%= link_to "I'm Done with this challenge >> Submit my score: #{total_score1} ", challenge_comp_challenges_path(:id=>@challenge.id) , :class => "links_score_p" %>
            </td>
          </tr>
        </table>
      <% end %>
      <a class="tlink" href="#">[Top]</a><br>&nbsp;</div>
      
      
      
      
      <!--Only my friend -->
      <div class="showhide" id="myTable13" name="myTable13" style="margin-top:90px;">	
      <table id="myTable1" class='tablesorter1' width="100%">  
        
        <tr id="sTable">
          <th width="8%">Rank</th>
          <th width="23%">Contestants</th>
          <th width="8%"></th>
          <th width="45%">Achievement</th>
          <th width="17%">Time</th>
        </tr>    

        <tbody>
          <% @flag = 1 %>
          <% @latestScore = 1 %>
          <% lastUpdate = @challenge.created_at %>
          <% Challenge.scoreboard(params[:id]).each do |listOfAll| %>
            <% if @onlyMyFrdInChallenge.include?(listOfAll[0]) %>    
              <tr>
                <td class="bordercolor">        
                  <% unless listOfAll[1] == 0 %>
                    <% if @flag == 1 %>
                      <%= image_tag("gold.png") %>
                      gold
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% elsif @flag == 2 %>
                      <% if @latestScore == listOfAll[1] %>
                        <%= image_tag("gold.png") %>
                        gold
                      <% else %>
                        <%= image_tag("silver.png") %>
                        silver
                        <% @latestScore = listOfAll[1] %>
                        <% @flag += 1 %>
                      <% end %>              
                    <% elsif @flag == 3 %>              
                      <% if @latestScore == listOfAll[1] %>
                        <%= image_tag("silver.png") %>
                        silver
                      <% else %>
                        <%= image_tag("brozone.png") %>
                        bronze
                        <% @latestScore = listOfAll[1] %>
                        <% @flag += 1 %>
                      <% end %> 
                    <% elsif @flag == 4 %>
                      <% if @latestScore == listOfAll[1] %>
                        <%= image_tag("brozone.png") %>
                        bronze
                      <% else %>
                        <%= image_tag("blue.png") %>
                        blue
                        <% @latestScore = listOfAll[1] %>
                        <% @flag += 1 %>
                      <% end %>                
                    <% elsif @flag == 5 %>
                      <% if @latestScore == listOfAll[1] %>
                        <%= image_tag("blue.png") %>
                        blue
                      <% else %>
                        <%= image_tag("red.png") %>
                        red
                        <% @latestScore = listOfAll[1] %>
                        <% @flag += 1 %>
                      <% end %>                
                    <% elsif @flag == 6 %>
                      <% if @latestScore == listOfAll[1] %>
                        <%= image_tag("red.png") %>
                        red
                      <% else %>
                        <%= image_tag("platinum.png") %>
                        platinum
                        <% @latestScore = listOfAll[1] %>
                        <% @flag += 1 %>
                      <% end %>                
                    <% else %>

                    <% end %>            
                  <% else %>

                  <% end %>     
                </td>
                <td class="bordercolor">
                  <%= FbGraph::User.new(listOfAll[0]).fetch.name %><br>
                  <%= image_tag(FbGraph::User.new(listOfAll[0]).fetch.picture) %>
                </td>
                <td class="bordercolor">
                  <section id="taskpercentages">
                    <section id="taskpercentageMyFriend<%= listOfAll[0] %>">

                    </section>            
                  </section>
                </td>
                <td class="bordercolor">
                  <% eachChallenge = Challenge.all(conditions: {:user_id => listOfAll[0], :title=>@challenge.title}).first %>
                  <% total_score = 0 %>
                  <% total_score_count = 0 %>
                  <% total = 0 %>              
                  <% eachChallenge.tasks.each do |aTask| %>
                    <% total += aTask.score.to_i %>
                    <% if (aTask.is_complete == 1 ) %>
                      <% total_score+=Integer(aTask.score) %>  
                      <% total_score_count += 1 %>                  
                      <% if lastUpdate.to_i < aTask.updated_at.to_i %>                        
                        <% lastUpdate = aTask.updated_at %>
                      <% end %>                     
                    <% end %>
                  <%end%>             
                  <section style="width:110%">                
                    <section class="task" id="taskprogressMyFriend<%= eachChallenge.user_id %>"></section>
                    <section class="sshowperscore_personal"></section>	
                    <section id="sblackbox_personal">
                      <section class="snotcompleted2">
                        <span class="tasks_color"><%= (total-total_score) %></span> <span class="show_scoreboard_span">points (<%= eachChallenge.tasks.count.to_i-total_score_count.to_i %>&nbsp; tasks)</span>
                      </section>                   
                    </section>
                    <br>
                  </section>
                  <script type="text/javascript">
                          $(function() {
                            $("#taskprogressMyFriend<%= eachChallenge.user_id %>").progressbar({ value: Math.round(((<%= total_score %>/<%= total %>)*100)) });							
             
                              $("<p>").attr("id", "sspercentage_personal").text($("#taskprogressMyFriend<%= eachChallenge.user_id %>").progressbar("option", "value")+ "%"   ).appendTo("#taskpercentageMyFriend<%= eachChallenge.user_id %>");
                            });
                  </script>
                </td>
                <td class="bordercolor">        		
                  <% diffTime = lastUpdate.to_i %>
                  <% if diffTime > 8640 %>
                    <%= lastUpdate.strftime("%b %d, %Y") %>	
                  <% else %>
                    <%= time_ago_in_words  lastUpdate %>
                  <% end %>        
                </td>
              </tr>
              <% lastUpdate = @challenge.created_at %>
            <% end %>
          <% end %>  
        </tbody>
      </table>
      <% if @challenge.is_complete != 1 %>
        <table style="margin-top: -70px;">
          <tr>
            <td colspan="5">    		
              <%= link_to "I'm Done with this challenge >> Submit my score: #{total_score1} ", challenge_comp_challenges_path(:id=>@challenge.id) , :class => "links_score_p" %>
            </td>
          </tr>
        </table>
      <% end %>
      <a class="tlink" href="#">[Top]</a><br>&nbsp;</div>
      
      
      
      <!--My comptitor-->
    <div class="showhide" id="myTable14" name="myTable14">	
      <table id="myTable1" class='tablesorter1' width="100%" style="margin-top:90px;">   
    
        <tr id="sTable">
          <th width="8%">Rank</th>
          <th width="23%">Contestants</th>
          <th width="8%"></th>
          <th width="45%">Achievement</th>
          <th width="17%">Time</th>
        </tr>    

        <tbody>
          <% sl = 0 %>
          <% @flag = 1 %>
          <% @latestScore = 1 %>
          <% lastUpdate = @challenge.created_at %>
          <% @winner = Challenge.scoreboard(params[:id]) %>
          <% @total = 0 %>
          <% @challenge.tasks.each do |aTask| %>
            <% @total += aTask.score.to_i %>
          <%end%>
          <% @myComptitor=Hash.new() %>
          <% @winner.each do |a,b | %>
            <% if b >= @total %>	
              <% @myComptitor[a] = b %>
            <% end %>		
          <% end %>
<%# @myComptitor = @winner.take_while {|a,b | b < @total } %>
          <% [1, 2, 3, 4, 5, 0].take_while {|i| i < 3 } %>
          <% @myComptitor.each do |listOfAll| %>       
            <tr>
              <td class="bordercolor">        
                <% unless listOfAll[1] == 0 %>
                  <% if @flag == 1 %>
                    <%= image_tag("gold.png") %>
                    gold
                    <% @latestScore = listOfAll[1] %>
                    <% @flag += 1 %>
                  <% elsif @flag == 2 %>
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("gold.png") %>
                      gold
                    <% else %>
                      <%= image_tag("silver.png") %>
                      silver
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %>              
                  <% elsif @flag == 3 %>              
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("silver.png") %>
                      silver
                    <% else %>
                      <%= image_tag("brozone.png") %>
                      bronze
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %> 
                  <% elsif @flag == 4 %>
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("brozone.png") %>
                      bronze
                    <% else %>
                      <%= image_tag("blue.png") %>
                      blue
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %>                
                  <% elsif @flag == 5 %>
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("blue.png") %>
                      blue
                    <% else %>
                      <%= image_tag("red.png") %>
                      red
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %>                
                  <% elsif @flag == 6 %>
                    <% if @latestScore == listOfAll[1] %>
                      <%= image_tag("red.png") %>
                      red
                    <% else %>
                      <%= image_tag("platinum.png") %>
                      platinum
                      <% @latestScore = listOfAll[1] %>
                      <% @flag += 1 %>
                    <% end %>                
                  <% else %>

                  <% end %>            
                <% else %>

                <% end %>     
              </td>
              <td class="bordercolor">
                <%= FbGraph::User.new(listOfAll[0]).fetch.name %><br>
                <%= image_tag(FbGraph::User.new(listOfAll[0]).fetch.picture) %>
              </td>
              <td class="bordercolor">
                <section id="taskpercentages">
                  <section id="taskpercentageMyCom<%= listOfAll[0] %>">

                  </section>            
                </section>
              </td>
              <td class="bordercolor">
                <% eachChallenge = Challenge.all(conditions: {:user_id => listOfAll[0], :title=>@challenge.title}).first %>
                <% total_score = 0 %>
                <% total_score_count = 0 %>
                <% total = 0 %>              
                <% eachChallenge.tasks.each do |aTask| %>
                  <% total += aTask.score.to_i %>
                  <% if (aTask.is_complete == 1 ) %>
                    <% total_score+=Integer(aTask.score) %>  
                    <% total_score_count += 1 %>                  
                    <% if lastUpdate.to_i < aTask.updated_at.to_i %>                        
                      <% lastUpdate = aTask.updated_at %>
                    <% end %>                     
                  <% end %>
                <%end%>             
                <section style="width:110%">                
                  <section class="task" id="taskprogressMyCom<%= eachChallenge.user_id %>"></section>
                  <section class="sshowperscore_personal"></section>	
                  <section id="sblackbox_personal">
                    <section class="snotcompleted2">
                      <span class="tasks_color"><%= (total-total_score) %></span> <span class="show_scoreboard_span">points (<%= eachChallenge.tasks.count.to_i-total_score_count.to_i %>&nbsp; tasks)</span>
                    </section>                   
                  </section>
                  <br>
                </section>
                <script type="text/javascript">
                          $(function() {
                            $("#taskprogressMyCom<%= eachChallenge.user_id %>").progressbar({ value: Math.round(((<%= total_score %>/<%= total %>)*100)) });							
             
                              $("<p>").attr("id", "sspercentage_personal").text($("#taskprogressMyCom<%= eachChallenge.user_id %>").progressbar("option", "value")+ "%"   ).appendTo("#taskpercentageMyCom<%= eachChallenge.user_id %>");
                            });
                </script>
              </td>
              <td class="bordercolor">        		
                <% diffTime = lastUpdate.to_i %>
                <% if diffTime > 8640 %>
                  <%= lastUpdate.strftime("%b %d, %Y") %>	
                <% else %>
                  <%= time_ago_in_words  lastUpdate %>
                <% end %>        
              </td>
            </tr>
            <% lastUpdate = @challenge.created_at %>
            <% sl +=1 %>
            <% if sl.to_i == 10 %>
              <% break %>
            <% end %>
          <% end %>      
        </tbody>
      </table>
      <% if @challenge.is_complete != 1 %>
        <table style="margin-top: -70px;">
          <tr>
            <td colspan="5">
              <%= link_to "I'm Done with this challenge >> Submit my score: #{total_score1} ", challenge_comp_challenges_path(:id=>@challenge.id) , :class => "links_score_p" %>
            </td>
          </tr>
        </table>
      <% end %>
      <a class="tlink" href="#">[Top]</a><br>&nbsp;</div>
      
      

    <!--
    <div class="showhide" id="myTable13" name="myTable13">Hey! Hey! Hey! Hey! <a class="tlink" href="#">[Top]</a><br>&nbsp;</div>
    -->
  </div>



  <script type="text/javascript">
              var disStyle=0
              var dom=document.getElementById||document.all

              function getItem(id) {
                return document.getElementById&&document.getElementById(id)? document.getElementById(id) : document.all&&document.all[id]? document.all[id] : null;
              }

              if(dom)
                document.write('<style type="text/css" id="dummy">\
  .tlink{\
  display:none;\
  }\
  <\/style>')

              if(dom&&typeof getItem('dummy').disabled=='boolean'){
                document.write('<style type="text/css" id="showhide">\
  .showhide{\
  display:none;\
  }\
  #cdiv10 {\
  display:block;\
  }\
  <\/style>');
                disStyle=1;
              }

              function displayOne(idPrefix, idNum)
              {
                var i=0;
                //alert("i="+1);
                //alert("idPrefix="+idPrefix);
                //alert("idNum="+idNum);
                while (getItem(idPrefix+i)!==null)
                {
                  getItem(idPrefix+i).style.display='none';
                  i++;
                }
                if (typeof idNum!=='undefined')
                  getItem(idPrefix+idNum).style.display='';
              }

              onload=function(){
                displayOne('myTable1', 0);
                if (disStyle)
                  getItem('showhide').disabled=true;
              }
  </script>


  <script type="text/javascript">
              $(document).ready(function()
              {
                $('#search').keyup(function()
                {
                  searchTable($(this).val());
                });
              });
							
              function searchTable(inputVal)
              {
                var table = $('.tablesorter1');
                table.find('tr').each(function(index, row)
                {
                  var allCells = $(row).find('td');
                  if(allCells.length > 0)
                  {
                    var found = false;
                    allCells.each(function(index, td)
                    {
                      var regExp = new RegExp(inputVal, 'i');
                      if(regExp.test($(td).text()))
                      {
                        found = true;
                        return false;
                      }
                    });
                    if(found == true)$(row).show();else $(row).hide();
                  }
                });
              }
  </script>
