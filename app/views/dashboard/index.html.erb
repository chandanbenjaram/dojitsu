<%= javascript_include_tag('ui.progressbar')%>
<%= stylesheet_link_tag('jquery-ui', 'ui.progressbar','ui.theme', 'main')%>

<%= render 'layouts/loggedinbody'%>
<div class="challange">
	my dashboard
</div>

<% as= current_user.challenges.size %>
<table>
	<td>
	<content>		
	<table>
		<td>
			<tr>
				<td>
					<%= render :partial=> "dashboard/dashboardsidebar" %>						
				</td>
			</tr>
			<tr>
				<td>	
					<div class="dashboardsidebar1">
						<div class="mychallenge">
							<div id="titlechallenge">
								<div style="padding-left:16px;">
									NEW MESSAGES <font style="color:#fff">( <%= current_user.inbox.count %> )</font>
								</div>
								<div class="second_titlechallenge">
									<%= button_to "", new_challenge_url, :class => "new_challenge_button", :method => :get%>
								</div>
							</div>
							<div style="overflow-y: auto; overflow-x: hidden;" id="challengedetails">
								
							<div>
								<table class="sortable">
								<thead>
								  <tr><th style="CURSOR: pointer; cursor: hand;" id="content1">FROM</th><th style="CURSOR: pointer; cursor: hand;" id="content2"><span class="time2">TIME</span></th></tr>
								</thead>
								<tbody>
									<% current_user.inbox.each do |userMessage| %>
									<tr>
										<td width="10%">
											<%=image_tag(FbGraph::User.new(userMessage.from).fetch.picture) %>																			
										</td>
										<td width="88%">
											<font size="3px" style="float:right"><%= time_ago_in_words userMessage.created_at %></font>
											<font size="4px" style="font-weight:bold"><%= userMessage.subject %></font></br>
											<font size="3px"><%=h truncate(userMessage.body, :length => 55) %>..</font></br>										</td>
									</td>
									</tr>
									
									<% end %>
									</tbody>
								</table>		
							</div>
						</div>
						
					</div>
				</td>
			</tr>
		</td>
	</table>
	</content>
    </td>
	<td valign=top>
		<div class="dashboardsidebar2">
			<div class="whatsnew" style="float:left; position: relative;">	
			<div style="position:relative;  left: 16px; top:5px; ">WHAT'S NEW </div>
			
			<div class="viewall2">
				<%= button_to "", challenges_url, :class => "ds_view_all", :method => :get%>
			</div>
			</div>
			<% if current_user.allChallenges.count == 0 %>
				<p align="center">No challenges found</p>
			<% else %>
				<% current_user.allChallenges.each do |anc| %>
				<div id="contentbox">
					<%= image_tag("new.gif", :height => '30', :width => '30' ,:style =>"margin-top:0px; margin-left:0px;") %>
					<table width="100%" style="margin-top:-10px;">
						<tr>
							<td width="60%"><font size="3px;" style="font-weight:bold"><%= anc.title%></font></td>
							<td width="40%">
								<%= time_ago_in_words  anc.created_at%>
							</td>
						</tr>
					    <tr>
							<td colspan="2">													
								by
								
								<% if anc.instance_of?ChildChallenge %>
								   <% @parentChallenge = Challenge.where(:_id => anc.challenge_id).first%>
								   <script>
									var ordId = <%=  orgId = @parentChallenge.user_id %>
								   </script>
								   <b><%= FbGraph::User.new(@parentChallenge.user_id).fetch.name %></b>
								<% else %>
									<b><%= FbGraph::User.new(anc.user_id).fetch.name %></b>
								<% end %>
								
								
							</td>
						</tr>
						<tr>
							<td colspan="2">
								<% if anc.start_point.instance_of?PointDateType %>
									<%= anc.start_point.value.strftime("%b %d, %Y")%> - <%= anc.end_point.value.strftime("%b %d, %Y")%>
								<% else %>
									<%= anc.start_point.value rescue 0%> - <%= anc.end_point.value rescue 0%>
								<% end %>
							</td>
						</tr>
						<tr>
							<td colspan="2"><%= anc.child_challenges.size%> contestants</td>
						</tr>
						<tr>
							<td colspan="2">
								<% if anc.personal_type.instance_of?ChallengePersonalType%>
									<p style="text-transform:none;">
										<%=h truncate(anc.description, :length => 128) %>....<%= link_to "VIEW" , show_per_challenges_path(:id => anc.id) %>									
									</p>
								<% end %>
								<% if anc.social_type.instance_of?ChallengeSocialType%>
									<p style="text-transform:none;">
										<%=h truncate(anc.description, :length => 128) %>....<%= link_to "VIEW" , show_soc_challenges_path(:id => anc.id) %>									
									</p>
								<% end %>								
							</td>
						</tr>
					</table>
				</div>
			<% end %>
			<% end %>
			
		</div>
	</td>
</table>
