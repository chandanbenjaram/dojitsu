<%= javascript_include_tag('ajaxPageLoad','fbWallPost','jquery.colorbox-min', 'simple-tabs-dashboard')%>
<%= stylesheet_link_tag('jquery-ui', 'ui.theme', 'main', 'dashboard','colorbox','messageCss','simple-tabs-dashboard','dashboard_new')%>
<%= render 'layouts/loggedinbody'%>
<% if session[:isNewChallenge] == "isNew" %>
    <script>
      $.dojitsuWallPost.renderFbWallPost();
    </script>
<% end %>
<span class="mydashbotitle">MY DASHBOARD</span>

<table>
<td>
	<content>
	<table>
	<td>
	<tr>
       <td>
         <div class="dashboardsidebar">
            <div class="mychallenge">
             <div class="menubar">
					<span id="howiamgoindspace"><span id="shadow">HOW AM I DOING?</span></span>
						<div id="selecttb"> 
						<select id ="first">	
							<option  id ="first" value="others" >AGINST OTHERS</option>
							<option  id ="first" value="myself" selected="yes">AGINST MYSELF</option>
						</select>
						 
					</div>
					<%# image_tag , challenges_url, :class => "ds_view_all_challenge", :method => :get%>
					<%=link_to( image_tag("viewallbutton.PNG"), challenges_url, :class=>"ds_view_all_challenge") %>
					<%=link_to( image_tag("newbutton.PNG"), new_challenge_url, :class => "new_challenge") %>

			</div>

				<div id="againstother">
					 <%= render :partial => "dashboard/against_others" %>
				</div>
				<div id="againstmyself">
					 <%= render :partial => "dashboard/against_myself" %>
				</div>
			
            </div>
          </div>
      </td>
<script>	
$(document).ready(function(){
	$("#againstmyself").show();
	 $("#againstother").hide();
	$("#first").change(function()
	{
		 var myfre = $("#first").val();
		 if(myfre == "others")
		 {
			 $("#againstmyself").hide();
			 $("#howamdoing").replaceWith($("#againstother").show());
		 }
		 else 
		 {
			 $("#againstother").hide();
			 $("#howamdoing").replaceWith($("#againstmyself").show());
		 }
	});

});
</script>
 
        </tr>
        <tr>
          <td>	
              <div class="dashboardsidebar1">
                  <div class="mychallenge">
                      <div id="titlechallenge">
                          <div id="title" style="left: 16px; position: relative; top: 5px;">
                             <div class="shadow">new messages <font style="color:#fff">&nbsp;&nbsp;( <%= current_user.inbox.count %> )</font></div>
                          </div>
                          <div class="second_titlechallenge">
                             <%= button_to "", "#", :class => "new_message_button", :method => :get%>
                          </div>
                      </div>
                      <div style="overflow-y: auto; overflow-x: hidden;" id="challengedetails">
                      <div id="message"></div>
                      <div id="message1" align="center"></div>
                      <script>
                        $.dojitsuAjaxPage.renderAjaxPageLoad("/dashboard/message","#message","#message1");
                      </script>
                  </div>	
              </div>
          </td>
      </tr>
   </td>
</table>
</content>
</td>
<td valign=top>
    <div class="dashboardsidebar2">
      <div class="whatsnew">
          <div class="shadow1" id="shadowcolor">what's new</div>
                                  <%= button_to "", challenges_url, :class => "ds_view_all", :method => :get%>
          </div>
          <% if Challenge.whatsNew.count == 0 %>
    <p align="center">No challenges found</p>
<% else %>
<% Challenge.whatsNew.each do |aChallenge| %>
    <div id="contentbox" >
	 
        <%= image_tag("new_banner.png", :class => "imagestyle") %>
        <table width="100%" class="maintable">
            <tr>
              <td width="70%" class="firsttdst">
                  <span class ="chatitle"><%= aChallenge.title%></span>	<br>										
                  by
                  <% if aChallenge.instance_of?ChildChallenge %>
                     <% @parentChallenge = Challenge.where(:_id => aChallenge.challenge_id).first%>
                     <script>
                         var ordId = <%=  orgId = @parentChallenge.user_id %>
                     </script>
                     <b>
                        <% if isStandalone %>
                            <%= @parentChallenge.first_name %>
                        <% else %>
                            <%= FbGraph::User.new(@parentChallenge.user_id).fetch.name %>
                        <% end %>                                  
                     </b>
                  <% else %>
                          <b>
                              <% if isStandalone %>
                                  <%= current_user.gmauth.first_name %>
                              <% else %>
                                  <%= FbGraph::User.new(aChallenge.user_id).fetch.name %>
                              <% end %>                                  
                          </b>
                  <% end %>
<br>	
                  <% if aChallenge.start_point.instance_of?PointDateType %>
                          <%= aChallenge.start_point.value.strftime("%b %d, %Y")%> - <%= aChallenge.end_point.value.strftime("%b %d, %Y")%>
                  <% else %>
                          <%= aChallenge.start_point.value rescue 0%> - <%= aChallenge.end_point.value rescue 0%>
                  <% end %>

                  <% if aChallenge.child_challenges.size<2 %>
                   <%= aChallenge.child_challenges.size%>&nbsp;&nbsp;contestant
                   <%else%>
                  <%= aChallenge.child_challenges.size%>&nbsp;&nbsp;contestants
                  <%end%>
                  <p class="texttransormn">
                          <%=h truncate(aChallenge.description, :length => 15) %>&nbsp;&nbsp;<b><%= link_to "view" , show_soc_challenges_path(:id => aChallenge.id), :class => 'underline_view'   %>	</b>								
              </td>
              <td valign="top" width="30%" class="tdalign" >
                              <p class = "timestyle"><%= time_ago_in_words  aChallenge.created_at%></p>
              </td>
            </tr>
        </table>
    </div>
    <% end %>
<% end %>
      </div>
    </td>
</table>
        
<section style="display:none;">
<section id="sendNewMessage">
    <%= form_tag newmessage_messages_path, :method => :get do  %>
    <table width="100%" bgcolor="#f4f4f4">
      <tr bgcolor="#f4f4f4">
        <td colspan="2">
          <span id="messageTextHead">New Message</span>
        </td>
      </tr>
      <tr bgcolor="#ffffff">
        <td width="17%" class="bordercolort1">
          <span id="messageText">T0</span>        
        </td>
        <td width="83%" class="bordercolort1">
          <%= text_field_tag 'to', nil, :size=>"61" %>        </td>
      </tr>
      <tr bgcolor="#ffffff">
        <td>
          <span id="messageText">MESSAGE</span>
        </td>
        <td>
          <%= text_area_tag 'message','', :class =>"textareaMessage" %>
        </td>
      </tr>
      <tr bgcolor="#ffffff">
        <td class="bordercolort1">
          &nbsp;&nbsp;&nbsp;&nbsp;<%= image_tag("icon_attach_mo.png") %>&nbsp;&nbsp;&nbsp;&nbsp;
          <%= image_tag("icon_photo_mo.png") %>
        </td>
        <td class="bordercolort1">
          <section style="float: right;">
            <%= check_box_tag 'toMobile','', false %>
            <%= image_tag("icon_sms_mo.png") %>
          </section>
        </td>
      </tr>
      <tr bgcolor="#ffffff">
        <td colspan="2">
          <%= link_to "CANCEL",  dashboard_index_path, :style => "text-decoration: none; color:#fff; float:right" ,:class => "links_cancel_message"%>        
          <%= submit_tag "SEND", :style => "width: 80px; float:right;", :class => "linksNewMessage" %>
        </td>
      </tr>
    </table>
    <% end %>
</section>
</section>    
        
<script>
    $(".new_message_button").click(function(){
        //alert("Maisa");
        $.colorbox({
              opacity: 0.40,
              transition: 'none',
              speed: 200,
              width: 460,
              scrolling: true,
              inline:true, 
              href:"#sendNewMessage",
              title: '',
              overlayClose: true,
              onComplete: function () {
                  // $(this).initFunctions(); // if you want to reinit another colorbox, you should pass the element as an argument to initFunctions rather than calling this as a blanket initializer for all colorboxes.
              }              
          });
    });
</script>    

