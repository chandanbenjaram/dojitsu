<%= stylesheet_link_tag('_against_other')%>
<table>
	<thead>
		<tr id="tableheader">
			<th id="namespace">NAME
			</th>
			<th>RANK
			</th>
			<th><span id="theadmyscore">MY SCORE </span><span id = "theadtopscore">TOP SCORE</span>
			</th>
			<th id="lastupspace">LAST UPDATE
			</th>
		</tr>
	</thead>
	<tbody>
		<% total_challenges =[]	%>
	    <% current_user.challenges.each do |userChallenge| %>
			<% total_challenges<<userChallenge %>
		<%end%>
	   <% taskCompleted=1 %>
	   <% total_challenges.take(3).each do |limitChallenge|%>
	  	<tr>
		   <td class="bordercolort" >	
                 <br> <span class="userchallengestyle"><b><%= limitChallenge.title %></b></span><br>  
                  <% if limitChallenge.instance_of?ChildChallenge %>
                     <% @parentChallenge = Challenge.where(:_id => limitChallenge.challenge_id).first%>
                     <script>
                         var ordId = <%=  orgId = @parentChallenge.user_id %>
                     </script>
                     <div class="chname">by
                        <% if isStandalone %>
                            <%= @parentChallenge.first_name %>
                        <% else %>
                            <%= FbGraph::User.new(@parentChallenge.user_id).fetch.name %>
                        <% end %>                                  
                    </div>                     
                  <% else %>
                     <div class="chname">by
                          <% if isStandalone %>
                              <%= current_user.gmauth.first_name %>
                          <% else %>
                              <%= current_user.facebook.name %>
                          <% end %>                                  
                      </div>   
                  <% end %>
                  <span class="stedpoint"><%=  limitChallenge.start_point.value %> - <%= limitChallenge.end_point.value %></span> 
              </td>
			  <td  class="bordercolortdb" ><span id ="rankspoints"><u>0</u></span><br>
				<span id="extraspace">(of 1233)</span>
			  </td>
			  <td class="bordercolort">
			         <div class="taskprogress1" id="taskprogress1<%= taskCompleted %>"></div><br/>
                          <% flag1=0 %>
                          <% flag2=0 %>
						  <% flag3=0 %>
                          <% aScore= 0 %>
                          <% bScore= 0 %>
						  <% cScore= 0 %>
                          <% limitChallenge.tasks.each do |aTask| %>
							<% cScore+=Integer(aTask.score) %>
							<% flag3+=1 %>
                              <% if (aTask.is_complete == 1 ) %>
                                <% aScore+=Integer(aTask.score) %>
                                <% flag1+=1 %>
                              <% else %>
                                <% bScore += aTask.score.to_i %>
                                <% flag2+=1 %>
                              <% end %>
                          <% end %>
						  
					
                     
                     <div class="overalltasks"><span><%= aScore %></span> points <br/>(<%= flag1 %>&nbsp;tasks)</div>
                      
                     <div class="pointscolor2"><%= cScore %> points <br>(<%= flag3 %>&nbsp;tasks)</div>
                     
					<script type="text/javascript">
                          $(function() {
                              $("#taskprogress1<%= taskCompleted %>").progressbar({ value: Math.round(((<%= aScore %>/<%= (aScore+bScore) %>)*100)) });
                              $("<p>").attr("id", "checkit1").text($("#taskprogress1<%= taskCompleted %>").progressbar("option", "value") + "%  ").appendTo("#taskprogress1<%= taskCompleted %>");
                          });
                      </script>
			  </td>
				  <td class="bordercolort" >
				  <span class = "timestyle1"><%= time_ago_in_words  limitChallenge.created_at%></span><br>				 
				  <%=link_to( image_tag("update.png"), show_per_challenges_path(:id => limitChallenge._id), :class=>"updatebutton") %>
			  </td>
			  <% taskCompleted+=1 %>
		</tr>
		<% end %>
	</tbody>
</table>
