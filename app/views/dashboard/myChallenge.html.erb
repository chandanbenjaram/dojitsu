<div class="dashboardsidebar">
	<div class="mychallenge">
		<div id="titlechallenge">
			<div id="title">
				MY CHALLENGES <font color="white"><b>( <%= current_user.challenges.size %> ) </b></font>
			</div>
			<div class="second_titlechallenge">
				<%= button_to "", new_challenge_url, :class => "new_challenge_button", :method => :get%>
			</div>
		</div>						
		
		<div style="overflow-y: auto; overflow-x: hidden;  height : 465px;" id="challengedetails">
			<% taskCompleted=1 %>
			<script src="http://www.kryogenix.org/code/browser/sorttable/sorttable.js"> </script>
			<table class="sortable">
				<thead>
				  <tr><th style="cursor: hand;" id="content1">NAME</th><th style="CURSOR: pointer; cursor: hand;" id="content2">MY DOJITSU SCORE</th></tr>
				</thead>
				<tbody>
					<% current_user.challenges.each do |userChallenge| %>
					<tr style="cursor: hand;" valign="top" class="challengerow" onclick="location.href='<%= show_per_challenges_path(:id => userChallenge)  %>'" >
						<td>	
							<font family="Arial" color="#666666" size=3"><b><%= userChallenge.title %></b></font><br><font size=2>by </font>
							<% if userChallenge.instance_of?ChildChallenge %>
							   <% @parentChallenge = Challenge.where(:_id => userChallenge.challenge_id).first%>
							   <script>
									var ordId = <%=  orgId = @parentChallenge.user_id %>
							   </script>
							   <b><%= FbGraph::User.new(@parentChallenge.user_id).fetch.name %></b>
							<% else %>
								<b><%= current_user.facebook.name %></b>
							<% end %>
							</font><br><%=  userChallenge.start_point.value %> - <%= userChallenge.end_point.value %><br>
							<%if ( userChallenge.child_challenges.size <2 ) %> 
								<%= userChallenge.child_challenges.size >0 ? userChallenge.child_challenges.size : 1  %> contestant<br>
							<% else %>
								<%= userChallenge.child_challenges.size %> contestants<br>
							<% end %>
						</td>
						<td >					
							<div class="taskprogress" id="taskprogress<%= taskCompleted %>"></div><br/>
								<div id="check1">
									<% flag1=0 %>
									<% flag2=0 %>
									<% aScore= 0 %>
									<% bScore= 0 %>
									<% userChallenge.tasks.each do |aTask| %>
										<% if (aTask.is_complete == 1 ) %>
											<% aScore+=Integer(aTask.score) %>
											<% flag1+=1 %>
										<% else %>
											<% bScore += aTask.score.to_i %>
											<% flag2+=1 %>
										<% end %>
									<% end %>
								<div class="update">
									<%= image_tag("FDFDG.gif", :alt => "Update")%>												
								</div>
								<div class="completedtask"> 
									<%= aScore %> points (<%= flag1 %> &nbsp; tasks)
								</div>
								<div class="notcompleted">
									<font size=3 color="#F8981D"><b>to go:</b></font>&nbsp; <font color="white"><%= bScore %> points (<%= flag2 %>&nbsp; tasks)</font>
								</div>
								<script type="text/javascript">
									$(function() {
										$("#taskprogress<%= taskCompleted %>").progressbar({ value: Math.round(((<%= aScore %>/<%= (aScore+bScore) %>)*100)) });
										$("<p>").attr("id", "check").text($("#taskprogress<%= taskCompleted %>").progressbar("option", "value") + "% Completed:  ").appendTo("#taskprogress<%= taskCompleted %>");
									});
								</script>
							</div>
							<div id="points">
								&nbsp;&nbsp;<font size=4><b><%= aScore %></b></font>
							</div>													
						</td>																					
						<% taskCompleted+=1 %>																
					</tr>
					<% end %>
				</tbody>
			</table>
		</div>
	</div>
</div>