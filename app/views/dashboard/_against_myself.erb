<%= stylesheet_link_tag('_against_myself')%>
<table width="100%" >	
	<thead id="tableheader ">
		<tr >
			<th width="20%" id="borderalign"><span id="spancefortext">NAME</span></th>
			<th width="40%" id="spancefortext2">COMPLETED</span></th>
			<th width="20%" id="spancefortext3">TO GO</span></th>
			<th width="20%" id="spancefortext4">LAST UPDATE</span></th>
		</tr>
	</thead>
	<tbody>
	<% total_challenges =[]	%>
	<% current_user.challenges.each do |userChallenge| %>
		<% total_challenges<<userChallenge %>	
	<%end%>
	<% taskCompleted=1 %>
	<% total_challenges.take(3).each do |limitChallenge|%>
	<tr width="50" >
		<td class="bordercolort" >	
        <br>
		<span class="userchallengestyle"><b><%= limitChallenge.title %></b></span>
		<br>  
        <% if limitChallenge.instance_of?ChildChallenge %>
           <% @parentChallenge = Challenge.where(:_id => limitChallenge.challenge_id).first%>
           <script>
                  var ordId = <%=  orgId = @parentChallenge.user_id %>
           </script>
           <div class="chname">by
           <% if isStandalone %>
                  <%= @parentChallenge.first_name %>
           <% else %>
                  <%= FbGraph::User.new(@parentChallenge.user_id).fetch.name %>
           <% end %>                                  
           </div>                     
        <% else %>
           <div class="chname">by
           <% if isStandalone %>
                   <%= current_user.gmauth.first_name %>
           <% else %>
                   <%= current_user.facebook.name %>
           <% end %>                                  
           </div>   
        <% end %>
        <span class="stedpoint"><%=  limitChallenge.start_point.value %> - <%= limitChallenge.end_point.value %></span>
        </td>
		<td class="bordercolort">
		   <div class="taskprogress" id="taskprogress<%= taskCompleted %>"></div><br/>
           <% flag1=0 %>
		   <% flag2=0 %>
           <% aScore= 0 %>
           <% bScore= 0 %>
           <% limitChallenge.tasks.each do |aTask| %>
			   <% if (aTask.is_complete == 1 ) %>
					<% aScore+=Integer(aTask.score) %>
					<% flag1+=1 %>
			   <% else %>
					<% bScore += aTask.score.to_i %>
					<% flag2+=1 %>
			   <% end %>
           <% end %>
		   <div class="completedtask"> 
				<%= aScore %> points <br> <%= flag1 %>&nbsp;tasks
           </div>
           <div class="notcompleted">
                <span class="pointscolor1"><%= bScore %> points <br> <%= flag2 %>&nbsp;tasks</span>
           </div>
		   <script type="text/javascript">
                          $(function() {
                              $("#taskprogress<%= taskCompleted %>").progressbar({ value: Math.round(((<%= aScore %>/<%= (aScore+bScore) %>)*100)) });
                              $("<p>").attr("id", "checkit").text($("#taskprogress<%= taskCompleted %>").progressbar("option", "value") + "%  ").appendTo("#taskprogress<%= taskCompleted %>");
                          });
           </script>
           </td>
		   <td class="bordercolort" >
		   </td>
		   <td class="bordercolort" >
				<span class = "timestyle1"><%= time_ago_in_words  limitChallenge.created_at%></span><br>
				<%=link_to( image_tag("update.png"), show_per_challenges_path(:id => limitChallenge._id), :class=>"updatebutton") %>
		   </td>
		<% taskCompleted+=1 %>	
		</tr>
		<%end%>
	</tbody>
</table>

